{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-]","pipeline":["stemmer"]},"docs":[{"location":"blog/","title":"\u54b8\u9c7c\u200b\u6684\u200b\u7684\u200b\u968f\u673a\u200b\u7b14\u8bb0","text":"<p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u4e1c\u897f\u200b\u6ca1\u4ec0\u4e48\u200b\u7528\u200b\uff1b\u200b\u6709\u7528\u200b\u7684\u200b\u6211\u200b\u90fd\u200b\u4f1a\u200b\u6574\u7406\u200b\u5230\u200b \u200b\u4e3b\u200b\u7ad9\u200b \u200b\u4e0a\u200b\u3002</p> \u200b\u5206\u7c7b\u200b\u89c4\u5219\u200b <p>\u200b\u5206\u7c7b\u200b (or tags) \u200b\u5e76\u200b\u4e0d\u200b\u652f\u6301\u200b\u7ea7\u522b\u200b\uff1b\u200b\u4f46\u200b\u5206\u7ea7\u200b\u786e\u5b9e\u200b\u662f\u200b\u5fc5\u8981\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6682\u5b9a\u200b\u5c06\u200b tags \u200b\u5206\u4e3a\u200b\u4e24\u7ea7\u200b\uff1a<code>{\u200b\u72b6\u6001\u200b}{\u200b\u8bdd\u9898\u200b}</code>\u3002</p> <p>\u200b\u9274\u4e8e\u200b\u76ee\u524d\u200b\u5185\u5bb9\u200b\u8f83\u200b\u5c11\u200b\uff0c\u300c\u200b\u8bdd\u9898\u200b\u300d\u200b\u6682\u65f6\u200b\u4e0d\u200b\u505a\u200b\u989d\u5916\u200b\u8981\u6c42\u200b\uff0c\u200b\u8868\u610f\u200b\u6e05\u6670\u200b\u5373\u53ef\u200b\u3002\u300c\u200b\u72b6\u6001\u200b\u300d\u200b\u4f7f\u7528\u200b\u56fe\u6807\u200b\uff0c\u200b\u5206\u4e3a\u200b 4 \u200b\u79cd\u200b\uff1a</p> <ul> <li> (draft)\uff1a\u200b\u6ca1\u5b66\u200b\u5b8c\u200b\u7684\u200b\u4e1c\u897f\u200b\uff1b</li> <li> (published)\uff1a\u200b\u5b8c\u6574\u200b\u7684\u200b\u8bdd\u9898\u200b\u6a21\u5757\u200b\uff0c\u200b\u800c\u200b\u975e\u200b random notes\uff1b</li> <li> (random notes)\uff1a\u200b\u968f\u624b\u200b\u8bb0\u200b\u7684\u200b\u4e1c\u897f\u200b\uff0c\u200b\u4e0d\u200b\u5b8c\u6574\u200b\uff0c\u200b\u4e5f\u200b\u6682\u65e0\u200b\u6574\u7406\u200b\u8ba1\u5212\u200b\uff1b</li> <li> (archived)\uff1a\u200b\u5df2\u7ecf\u200b\u7ecf\u8fc7\u200b\u6574\u7406\u200b\uff0c\u200b\u5e76\u5165\u200b <code>Published</code> \u200b\u6216\u4e3b\u7ad9\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</li> </ul> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u5206\u7c7b\u200b\u7528\u6765\u200b\u8868\u8fbe\u200b blog \u200b\u7684\u200b\u6027\u8d28\u200b\u800c\u200b\u975e\u200b\u5185\u5bb9\u200b\uff0c\u200b\u72b6\u6001\u200b\u4e00\u5f8b\u200b\u91c7\u7528\u200b \uff1a</p> <ul> <li>Daily\uff1a\u200b\u65e5\u5e38\u200b\u7684\u200b random notes\u3002</li> <li>Topics\uff1a\u200b\u5c31\u200b\u67d0\u4e2a\u200b\u8bdd\u9898\u200b\u5c55\u5f00\u200b\u7684\u200b\u77ed\u6587\u200b\u3002</li> </ul>"},{"location":"blog/2024-06-30-sun/","title":"2024-06-30 (Sun)","text":"<p>\u200b\u5b89\u88c5\u200b\u4e86\u200b\u4e00\u4e9b\u200b zsh \u200b\u63d2\u4ef6\u200b\uff0c\u200b\u8fc7\u200b\u5b8c\u200b\u4e86\u200b git \u200b\u7684\u200b\u914d\u7f6e\u200b\uff1b\u200b\u7528\u200b mkdocs \u200b\u642d\u200b\u4e86\u200b\u4e2a\u200b\u535a\u5ba2\u200b\u3002</p>"},{"location":"blog/2024-06-30-sun/#working-notes","title":"Working notes","text":"<ul> <li>\u200b\u60f3\u200b\u7ee7\u7eed\u200b\u5b66\u200b\u4e00\u4e0b\u200b Git\uff1b\u200b\u76ee\u524d\u200b\u7684\u200b\u72b6\u6001\u200b\u66f4\u65b0\u200b\u5728\u200b \u200b\u8fd9\u4e2a\u200b commit \u200b\u4e2d\u200b\u4e86\u200b\u3002<ul> <li>\u200b\u76ee\u524d\u200b\u4ecd\u7136\u200b\u5728\u200b\u770b\u200b git config \u200b\u7684\u200b\u76f8\u5173\u200b\u5185\u5bb9\u200b\uff1b\u200b\u770b\u5230\u200b\u4e86\u200b <code>help.autoCorrect</code> \u200b\u8bd5\u4e86\u8bd5\u200b\uff0c\u200b\u8be6\u7ec6\u200b\u7684\u200b\u5199\u200b\u5728\u200b git \u200b\u5b66\u4e60\u200b\u7b14\u8bb0\u200b \u200b\u91cc\u9762\u200b\u4e86\u200b\uff01</li> </ul> </li> <li>\u200b\u67e5\u200b git autoCompletion \u200b\u7684\u200b\u65f6\u5019\u200b\u770b\u5230\u200b\u4e86\u200b zhs \u200b\u7684\u200b auto suggestion\uff0c\u200b\u8fdb\u4e00\u6b65\u200b\u770b\u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b zsh plugin\uff0c\u200b\u5b89\u88c5\u200b\u4e86\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u4f53\u9a8c\u200b\u4e0d\u9519\u200b\uff01<ul> <li>\u200b\u73b0\u5728\u200b\u7684\u200b zsh \u200b\u72b6\u6001\u200b\u9644\u200b\u540e\u200b</li> </ul> </li> <li>\u200b\u524d\u200b\u51e0\u5929\u200b\u770b\u5230\u200b\u6709\u4eba\u200b\u7528\u200b mkdocs \u200b\u642d\u200b\u535a\u5ba2\u200b\uff0c\u200b\u597d\u50cf\u200b\u73b0\u5728\u200b\u4e0d\u662f\u200b sponsor only \u200b\u4e86\u200b\uff0c\u200b\u6765\u200b\u8bd5\u4e00\u4e0b\u200b</li> <li>\u200b\u60f3\u200b\u6709\u7a7a\u200b\uff08\u200b\u5199\u200b\u4e00\u534a\u200b\u53bb\u200b\u8dd1\u6b65\u200b\u53bb\u200b\u4e86\u200b\uff0c\u200b\u56de\u6765\u200b\u4e4b\u540e\u200b\u5fd8\u200b\u4e86\u200b\u5f53\u65f6\u200b\u60f3\u200b\u5e72\u200b\u5565\u200b\u4e86\u200b\uff0c\u200b\u5148\u653e\u200b\u8fd9\u91cc\u200b\uff09</li> <li>\u200b\u60f3\u200b\u5b66\u5b66\u200b rust</li> </ul>"},{"location":"blog/2024-06-30-sun/#appendix","title":"Appendix","text":""},{"location":"blog/2024-06-30-sun/#zsh-\u5b89\u88c5\u8fc7\u7684\u4e1c\u897f","title":"Zsh \u200b\u5b89\u88c5\u200b\u8fc7\u200b\u7684\u200b\u4e1c\u897f","text":"<ul> <li>oh-my-zsh</li> <li><code>ZSH_THEME=\"powerlevel10k/powerlevel10k\"</code></li> <li><code>plugins=(git zsh-autosuggestions zsh-syntax-highlighting you-should-use)</code></li> </ul>"},{"location":"blog/2024-06-30-sun/#mkdocs-\u642d\u535a\u5ba2","title":"mkdocs \u200b\u642d\u200b\u535a\u5ba2","text":"<ul> <li>\u200b\u6587\u6863\u200b\u5728\u200b \u200b\u8fd9\u91cc\u200b</li> <li>\u200b\u4f8b\u5b50\u200b\u5728\u200b \u200b\u8fd9\u4e2a\u200b commit</li> </ul>"},{"location":"blog/2024-07-07-sun/","title":"2024-07-07 (Sun)","text":"<p>\u200b\u7ee7\u7eed\u200b\u770b\u200b\u4e00\u4e0b\u200b Git\uff0c\u200b\u770b\u200b\u4e86\u200b <code>git init</code> \u200b\u7684\u200b\u9009\u9879\u200b\u3002</p>"},{"location":"blog/2024-07-07-sun/#git-init","title":"Git init","text":"<p>\u200b\u770b\u200b <code>git init</code> \u200b\u7684\u200b\u6587\u6863\u200b\uff0c\u200b\u770b\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u9009\u9879\u200b\u53eb\u200b <code>--seperate-git-dir</code>\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b .git \u200b\u76ee\u5f55\u200b\u653e\u5728\u200b\u5176\u4ed6\u200b\u5730\u65b9\u200b\uff1b\u200b\u800c\u200b .git \u200b\u7684\u200b\u4f4d\u7f6e\u200b\u653e\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u6307\u5411\u200b\u771f\u6b63\u200b\u7684\u200b\u76ee\u5f55\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\u80fd\u200b\u5b9e\u73b0\u200b \u200b\u5728\u200b working directory \u200b\u4e4b\u5916\u200b\u521b\u5efa\u200b git repo \u200b\u7684\u200b\u6548\u679c\u200b\u3002\u200b\u8fd9\u200b\u5728\u200b\u4ee5\u4e0b\u200b\u573a\u666f\u200b\u4e2d\u200b\u53ef\u80fd\u200b\u6709\u7528\u200b\uff1a</p> <ul> <li>working directory \u200b\u5bf9\u200b\u6211\u4eec\u200b\u6765\u8bf4\u200b\u662f\u200b\u53ea\u8bfb\u200b\u7684\u200b\uff08\u200b\u9700\u8981\u200b\u914d\u5408\u200b\u5176\u4ed6\u200b\u9009\u9879\u200b\uff0c\u200b\u53c2\u89c1\u200b \u200b\u8fd9\u91cc\u200b\uff09</li> <li>\u200b\u4e0d\u60f3\u200b\u5728\u200b working directory \u200b\u4e2d\u200b\u7559\u4e0b\u200b .git \u200b\u76ee\u5f55\u200b\u7684\u200b\u4e00\u5806\u200b\u4e1c\u897f\u200b</li> <li>working directory \u200b\u9700\u8981\u200b\u5171\u4eab\u200b\uff0c\u200b\u4f46\u200b .git \u200b\u4e0d\u200b\u9700\u8981\u200b\u5171\u4eab\u200b</li> <li>\u200b\u53ea\u60f3\u200b track working directory \u200b\u4e2d\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5c11\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u6587\u4ef6\u200b</li> </ul> <p>\u200b\u8fd8\u200b\u770b\u5230\u200b\u4e00\u4e2a\u200b\u9009\u9879\u200b\u53eb\u200b <code>--bare</code>\uff0c\u200b\u67e5\u200b\u4e86\u200b\u4e00\u4e0b\u200b\u8fd9\u662f\u200b\u4f5c\u4e3a\u200b remote repo \u200b\u65f6\u200b\u7684\u200b best practice\uff0c\u200b\u53c2\u89c1\u200b \u200b\u8fd9\u91cc\u200b\u3002\u200b\u6240\u4ee5\u200b\u6253\u7b97\u200b\u4ed4\u7ec6\u200b\u5b66\u200b\u4e00\u4e0b\u200b remote repo \u200b\u7684\u200b\u73a9\u6cd5\u200b\u3002</p> <p>Running <code>git init</code> in an existing repository is safe. It will not overwrite things that are already there. The primary reason for rerunning <code>git init</code> is to pick up newly added templates (or to move the repository to another place if <code>--separate-git-dir</code> is given).</p>"},{"location":"blog/2024-07-07-sun/#git-remote","title":"Git remote","text":"<p>\u200b\u6709\u70b9\u200b\u665a\u200b\u4e86\u200b\uff0c\u200b\u4e03\u70b9\u200b\u591a\u200b\u4e86\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u4e00\u5b9a\u200b\u5b66\u200b\uff01</p>"},{"location":"blog/2024-08-08-thu/","title":"2024-08-08 (Thu)","text":"<p>\u200b\u4eca\u5929\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e0b\u200b\u5f00\u53d1\u200b\u673a\u200b\u7684\u200b\u8fc1\u79fb\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u4e00\u4e0b\u200b\u505a\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u4e8b\u60c5\u200b\u3002</p>"},{"location":"blog/2024-08-08-thu/#ssh","title":"ssh","text":"<p>\u200b\u5bbf\u4e3b\u673a\u200b\u4e0a\u5f00\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b <code>ssh-keygen -t rsa -b 4096 -C &lt;my_email&gt;</code>\uff0c\u200b\u7136\u540e\u200b\u5c06\u200b <code>22_id_rsa.pub</code> \u200b\u6254\u200b\u5230\u200b\u4e86\u200b\u65b0\u200b\u673a\u5668\u200b\u7684\u200b <code>~/.ssh/authorized_keys</code> \u200b\u91cc\u9762\u200b\uff1b\u200b\u5e76\u200b\u5728\u200b\u5bbf\u4e3b\u673a\u200b\u7684\u200b <code>~/.ssh/config</code> \u200b\u91cc\u9762\u200b\u52a0\u200b\u4e86\u200b\u4e00\u6761\u200b\uff1a</p> <pre><code>Host 22\n    HostName ...\n    User dev\n    IdentityFile ~/.ssh/22_id_rsa\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b <code>ssh 22</code> \u200b\u8fde\u4e0a\u200b\u4e86\u200b\uff01</p>"},{"location":"blog/2024-08-08-thu/#zsh","title":"zsh","text":"<pre><code>function scp_multi() { \n  for item in \"$@\"; \n    do scp -r \"dev:$item\" \"22:$item\"; \n  done;\n};\n</code></pre> <p><code>scp_multi \"~/.zshrc\" \"~/.oh-my-zsh\" \"~/.p10k.zsh\"</code>\uff0c\u200b\u8fd8\u200b\u62fc\u63a5\u200b\u4e86\u200b <code>~/.zsh_history</code>\u3002</p> <p><code>scp_multi \"~/.aliyun\" \"~/.auth\" \"~/.aws\" \"~/.bashrc\"</code></p> <p><code>scp_home_multi .huge-config.toml .huge-cli-config.toml .gitconfig .condarc</code></p> <p><code>scp_home_multi .auth .aws .kube scripts</code></p> <p><code>scp_multi \"~/.jfrog/jfrog-cli.conf.v6\"</code></p>"},{"location":"blog/prometheus/","title":"Prometheus","text":"<p>Prometheus \u200b\u91c7\u96c6\u200b\u7cfb\u7edf\u200b\u6307\u6807\u200b (metrics)\uff0c\u200b\u5e76\u200b\u5c06\u200b\u5176\u200b\u5b58\u50a8\u200b\u4e3a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b (time series)\uff1b\u200b\u5e76\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u5957\u200b\u5f3a\u5927\u200b\u7684\u200b\u67e5\u8be2\u8bed\u8a00\u200b PromQL\uff0c\u200b\u7528\u4e8e\u200b\u67e5\u8be2\u200b\u548c\u200b\u5206\u6790\u200b\u8fd9\u4e9b\u200b\u6307\u6807\u200b\u3002\u200b\u901a\u5e38\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u4f7f\u7528\u200b Grafana \u200b\u6765\u200b\u628a\u200b\u8fd9\u4e9b\u200b\u6307\u6807\u200b\u53ef\u89c6\u5316\u200b\u3002</p> <p>\u200b\u672c\u6587\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b Prometheus \u200b\u7684\u200b\u57fa\u672c\u6982\u5ff5\u200b\u548c\u200b\u67e5\u8be2\u65b9\u6cd5\u200b\u3002</p> <p>Info</p> <p>\u200b\u5982\u679c\u200b\u6682\u65f6\u200b\u4ece\u672a\u200b\u5b9e\u9645\u200b\u63a5\u89e6\u200b\u8fc7\u200b Prometheus\uff0c\u200b\u60a8\u200b\u53ef\u4ee5\u200b\u5728\u200b \u200b\u8fd9\u91cc\u200b \u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b minimum \u200b\u7684\u200b end-to-end \u200b\u793a\u4f8b\u200b\u3002</p>"},{"location":"blog/prometheus/#1-concepts--\u57fa\u672c\u6982\u5ff5","title":"1 Concepts | \u200b\u57fa\u672c\u6982\u5ff5","text":""},{"location":"blog/prometheus/#11-data-model--\u6570\u636e\u6a21\u578b","title":"1.1 Data Model | \u200b\u6570\u636e\u6a21\u578b","text":"<p>Prometheus \u200b\u5b58\u50a8\u200b\u7684\u200b\u5185\u5bb9\u200b\u662f\u200b\u4e00\u7cfb\u5217\u200b <code>(metric_name, labels, timestamp, value)</code>\uff1b\u200b\u5176\u4e2d\u200b\uff1a</p> <ul> <li><code>metric_name</code> \u200b\u662f\u200b\u6307\u6807\u200b\u540d\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8868\u660e\u200b\u6307\u6807\u200b\u7684\u200b\u542b\u4e49\u200b (e.g. <code>http_requests_total</code>)\uff1b</li> <li><code>labels</code> \u200b\u662f\u200b\u53ef\u9009\u200b\u7684\u200b\uff0c\u200b\u5305\u542b\u200b\u4e00\u7ec4\u200b\u4efb\u610f\u952e\u200b\u503c\u200b\u5bf9\u200b\uff0c\u200b\u7528\u4e8e\u200b\u533a\u5206\u200b\u6307\u6807\u200b\u7684\u200b\u4e0d\u540c\u200b\u7ef4\u5ea6\u200b (e.g. <code>method=\"GET\"</code>)\uff1b<ul> <li>\u200b\u4f8b\u5982\u200b <code>http_requests_total{method=\"GET\", status=\"200\"}</code> \u200b\u8868\u793a\u200b <code>GET</code> \u200b\u8bf7\u6c42\u200b\u8fd4\u56de\u200b <code>200</code> \u200b\u7684\u200b\u603b\u200b\u6b21\u6570\u200b\uff1b</li> </ul> </li> <li><code>(timestamp, value)</code> \u200b\u88ab\u200b\u5408\u5e76\u200b\u79f0\u4e3a\u200b <code>sample</code>\uff0c\u200b\u8868\u793a\u200b\u5728\u200b\u67d0\u4e2a\u200b\u65f6\u95f4\u200b\u70b9\u4e0b\u200b <code>metric_name{labels}</code> \u200b\u7684\u200b\u503c\u200b\u3002<ul> <li><code>timestamp</code> \u200b\u7684\u200b\u7cbe\u5ea6\u200b\u662f\u200b\u6beb\u79d2\u200b\uff0c<code>value</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b float64 \u200b\u6570\u503c\u200b\u3002</li> </ul> </li> </ul>"},{"location":"blog/prometheus/#12-prometheus-\u5982\u4f55\u91c7\u96c6\u6307\u6807","title":"1.2 Prometheus \u200b\u5982\u4f55\u200b\u91c7\u96c6\u200b\u6307\u6807","text":"<p>\u200b\u5e38\u89c1\u200b\u8bed\u8a00\u200b\u90fd\u200b\u6709\u200b Prometheus \u200b\u7684\u200b client library\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\u4e2d\u200b\u91c7\u96c6\u200b\u6307\u6807\u200b\u5e76\u200b\u66b4\u9732\u200b\u51fa\u6765\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u670d\u52a1\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>/metrics</code> \u200b\u8def\u5f84\u200b\u4e0b\u200b\u66b4\u9732\u200b\u6307\u6807\u200b\uff0c\u200b\u6307\u6807\u200b\u53ef\u80fd\u200b\u5f62\u200b\u5982\u200b\uff1a</p> <pre><code># HELP python_gc_objects_collected_total Objects collected during gc\n# TYPE python_gc_objects_collected_total counter\npython_gc_objects_collected_total{generation=\"0\"} 4.6086284e+07\npython_gc_objects_collected_total{generation=\"1\"} 2.1484146e+07\npython_gc_objects_collected_total{generation=\"2\"} 6.290886e+06\n# HELP python_gc_objects_uncollectable_total Uncollectable objects found during GC\n# TYPE python_gc_objects_uncollectable_total counter\npython_gc_objects_uncollectable_total{generation=\"0\"} 0.0\npython_gc_objects_uncollectable_total{generation=\"1\"} 0.0\npython_gc_objects_uncollectable_total{generation=\"2\"} 0.0\n# HELP http_requests_total Total number of HTTP requests\n# TYPE http_requests_total counter\nhttp_requests_total{method=\"post\",code=\"200\"} 1027.0\nhttp_requests_total{method=\"post\",code=\"400\"} 3.0\nhttp_requests_total{method=\"get\",code=\"200\"} 10000.0\n</code></pre> <p>\u200b\u5728\u200b\u670d\u52a1\u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u63a5\u53d7\u200b\u5230\u200b http \u200b\u8bf7\u6c42\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u6839\u636e\u200b\u8bf7\u6c42\u200b\u7684\u200b method \u200b\u548c\u200b code \u200b\u4fee\u6539\u200b\u4e00\u6b21\u200b <code>http_requests_total</code> \u200b\u6307\u6807\u200b\u3002Prometheus \u200b\u6bcf\u9694\u200b\u6307\u5b9a\u200b\u7684\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u4f1a\u200b\u53bb\u200b <code>/metrics</code> \u200b\u62c9\u53d6\u200b\u8fd9\u4e9b\u200b\u6307\u6807\u200b\uff0c\u200b\u83b7\u5f97\u200b\u4e0a\u9762\u200b\u4ee3\u7801\u200b\u5757\u200b\u6240\u793a\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4ece\u800c\u200b\u83b7\u53d6\u200b\u5230\u200b <code>(metric_name, labels, timestamp, value)</code> \u200b\u7684\u200b data model\u3002</p> <p>Note</p> <p>\u200b\u5728\u200b Prometheus \u200b\u770b\u6765\u200b\uff0c\u200b\u4e00\u4e2a\u200b <code>metric_name{labels}</code> \u200b\u7684\u200b\u503c\u200b\u662f\u200b\u4e00\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u5373\u200b\u4e00\u7cfb\u5217\u200b <code>(timestamp, value)</code> \u200b\u7684\u200b\u96c6\u5408\u200b\u3002\u200b\u5982\u679c\u200b <code>labels</code> \u200b\u7684\u200b\u53d6\u503c\u200b\u53d1\u751f\u53d8\u5316\u200b\uff0cPrometheus \u200b\u4f1a\u200b\u8ba4\u4e3a\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u3002</p> <p>\u200b\u53e6\u5916\u200b\uff0c\u200b\u5728\u200b\u6bcf\u6b21\u200b\u6293\u53d6\u200b\u6570\u636e\u200b\u65f6\u200b\uff0cPrometheus \u200b\u8fd8\u4f1a\u200b\u989d\u5916\u200b\u8bb0\u5f55\u200b\u4ee5\u4e0b\u200b\u6307\u6807\u200b\uff1a</p> <ul> <li><code>up</code>\uff0c1 \u200b\u8868\u793a\u200b\u6293\u53d6\u200b\u6210\u529f\u200b\uff0c0 \u200b\u8868\u793a\u200b\u5931\u8d25\u200b\uff1b\u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u68c0\u67e5\u200b\u5b9e\u4f8b\u200b\u662f\u5426\u200b\u53ef\u7528\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\uff1b</li> <li><code>scrape_duration_seconds</code>\uff0c\u200b\u6293\u53d6\u200b\u6570\u636e\u200b\u7684\u200b\u8017\u65f6\u200b\uff1b</li> <li>\u200b\u8fd8\u6709\u200b\u66f4\u200b\u591a\u200b\uff0c\u200b\u53c2\u89c1\u200b Automatically generated labels and time series\u3002</li> </ul> <p>Info</p> <p>\u200b\u6709\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u88ab\u200b\u76d1\u63a7\u200b\u7684\u200b\u7ec4\u4ef6\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u652f\u6301\u200b\u88ab\u200b Prometheus \u200b\u76f4\u63a5\u200b\u6293\u53d6\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7ec4\u4ef6\u200b\u4e2d\u200b \u200b\u4e3b\u52a8\u200b Push\uff1b\u200b\u4f46\u200b\u8fd9\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5305\u542b\u200b\u5728\u200b\u672c\u6587\u200b\u7684\u200b\u5185\u5bb9\u200b\u4e2d\u200b\u3002\u3002</p>"},{"location":"blog/prometheus/#13-metric-types--\u6307\u6807\u7c7b\u578b","title":"1.3 Metric Types | \u200b\u6307\u6807\u200b\u7c7b\u578b","text":"<p>Prometheus \u200b\u7684\u200b client library \u200b\u652f\u6301\u200b\u4ee5\u4e0b\u200b 4 \u200b\u79cd\u200b\u6307\u6807\u200b\u7c7b\u578b\u200b\uff1b\u200b\u4f46\u200b\u8fd9\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b\u4fbf\u4e8e\u200b\u4f7f\u7528\u200b\u7684\u200b\u5c01\u88c5\u200b\uff0c\u200b\u5728\u200b Prometheus \u200b\u4e2d\u200b\u7684\u200b\u6307\u6807\u200b\u4ecd\u7136\u200b\u53ea\u6709\u200b <code>(metric_name, labels, timestamp, value)</code></p> <ul> <li><code>Counter</code>\uff1a\u200b\u53ea\u589e\u200b\u4e0d\u51cf\u200b\u7684\u200b\u8ba1\u6570\u5668\u200b\u3002\u200b\u5728\u200b client \u200b\u4e2d\u200b\uff0c\u200b\u652f\u6301\u200b <code>c.inc()</code> \u200b\u6216\u200b <code>c.inc(1.6)</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\u6765\u200b\u589e\u52a0\u200b\u5176\u503c\u200b\u3002</li> <li><code>Gauge</code>\uff1a\u200b\u53ef\u589e\u200b\u53ef\u51cf\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u5728\u200b client \u200b\u4e2d\u200b\uff0c\u200b\u652f\u6301\u200b <code>g.set(3.2)</code>, <code>g.inc()</code> \u200b\u6216\u200b <code>g.dec(10)</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\u6765\u200b\u4fee\u6539\u200b\u5176\u503c\u200b\u3002</li> <li><code>Histogram</code>\uff1a\u200b\u5bf9\u200b\u89c2\u5bdf\u200b\u7684\u200b\u7ed3\u679c\u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u5230\u200b\u9884\u5148\u6307\u5b9a\u200b\u597d\u200b\u7684\u200b\u82e5\u5e72\u200b\u8303\u56f4\u200b (bucket) \u200b\u4e2d\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7edf\u8ba1\u6570\u636e\u200b\u7684\u200b\u5206\u5e03\u200b\u60c5\u51b5\u200b\u3002\u200b\u5728\u200b client \u200b\u4e2d\u200b\uff0c\u200b\u652f\u6301\u200b <code>h.observe(3.2)</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\u6765\u200b\u8bb0\u5f55\u200b\u6570\u636e\u200b\u3002\u200b\u53c2\u89c1\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u3002</li> <li><code>Summary</code>\uff1a\u200b\u5bf9\u200b\u89c2\u5bdf\u200b\u7684\u200b\u7ed3\u679c\u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u5230\u200b\u9884\u5148\u6307\u5b9a\u200b\u597d\u200b\u7684\u200b\u82e5\u5e72\u5206\u200b\u4f4d\u6570\u200b (quantile) \u200b\u4e2d\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7edf\u8ba1\u6570\u636e\u200b\u7684\u200b\u5206\u5e03\u200b\u60c5\u51b5\u200b\u3002\u200b\u5728\u200b client \u200b\u4e2d\u200b\uff0c\u200b\u652f\u6301\u200b <code>s.observe(3.2)</code> \u200b\u7684\u200b\u64cd\u4f5c\u200b\u6765\u200b\u8bb0\u5f55\u200b\u6570\u636e\u200b\u3002\u200b\u53c2\u89c1\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u3002</li> </ul> <p>Warning</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff1a\u200b\u5e76\u975e\u200b\u6240\u6709\u200b\u7684\u200b client library \u200b\u90fd\u200b\u652f\u6301\u200b\u6240\u6709\u200b\u7684\u200b\u6307\u6807\u200b\u7c7b\u578b\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u622a\u81f3\u200b\u76ee\u524d\u200b Python \u200b\u7684\u200b client library <code>prometheus_client</code> \u200b\u4e0d\u200b\u652f\u6301\u200b <code>Summary</code> \u200b\u7684\u200b quantile \u200b\u914d\u7f6e\u200b\u3002</p> Histogram <p><code>Histogram</code> \u200b\u4f1a\u200b\u5c06\u200b\u89c2\u5bdf\u200b\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u5206\u6876\u200b (bucket)\uff0c\u200b\u7136\u540e\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u5206\u6876\u200b\u7684\u200b\u6570\u636e\u91cf\u200b\u3002\u200b\u5728\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b <code>Histogram</code> \u200b\u6307\u6807\u200b\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u6307\u5b9a\u200b\u5404\u4e2a\u200b bucket \u200b\u7684\u200b\u4e0a\u200b\u9650\u503c\u200b\uff1b<code>Histogram</code> \u200b\u5b9e\u9645\u4e0a\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u7cfb\u5217\u200b\u4e0d\u540c\u200b\u7684\u200b metric \u200b\u6765\u200b\u8bb0\u5f55\u200b\u89c2\u5bdf\u200b\u5f97\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u3002</p> <p>\u200b\u4e3e\u4f8b\u200b\u800c\u8a00\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b\u540d\u4e3a\u200b <code>http_request_duration_seconds</code> \u200b\u7684\u200b histogram \u200b\u6307\u6807\u200b\u6765\u200b\u8bb0\u5f55\u200b\u8bf7\u6c42\u200b\u7684\u200b\u54cd\u5e94\u200b\u65f6\u95f4\u200b\uff1b\u200b\u5b83\u200b\u5305\u542b\u200b <code>api</code> \u200b\u548c\u200b <code>method</code> \u200b\u4e24\u4e2a\u200b label\uff1b\u200b\u6211\u4eec\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7684\u200b\u51e0\u4e2a\u200b bucket: <code>(0.1, 0.5, 1.0, Inf)</code>\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5047\u5982\u200b\u6709\u200b <code>http_request_duration_seconds(api=\"/foo\", method=\"GET\").observe(0.8)</code>\uff0c\u200b\u90a3\u4e48\u200b client \u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u5982\u4e0b\u200b\u7684\u200b\u6570\u636e\u200b\uff1a</p> <pre><code>http_request_duration_seconds_bucket{le=\"0.1\",api=\"/foo\",method=\"GET\"} 0\nhttp_request_duration_seconds_bucket{le=\"0.5\",api=\"/foo\",method=\"GET\"} 0\nhttp_request_duration_seconds_bucket{le=\"1.0\",api=\"/foo\",method=\"GET\"} 1\nhttp_request_duration_seconds_bucket{le=\"+Inf\",api=\"/foo\",method=\"GET\"} 1\n\nhttp_request_duration_seconds_sum{api=\"/foo\",method=\"GET\"} 0.8\n\nhttp_request_duration_seconds_count{api=\"/foo\",method=\"GET\"} 1\n</code></pre> <p>1-4 \u200b\u884c\u200b\u7684\u200b\u51e0\u4e2a\u200b <code>&lt;metricName&gt;_bucket</code> \u200b\u4e2d\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u843d\u5230\u200b\u5404\u4e2a\u200b bucket \u200b\u7684\u200b\u6570\u636e\u91cf\u200b\uff1b<code>le</code> (less than or equal to) \u200b\u8868\u793a\u200b\u4e0d\u200b\u5927\u4e8e\u200b\u8be5\u503c\u200b\u7684\u200b observe \u200b\u6b21\u6570\u200b\u3002\u200b\u7b2c\u200b 6 \u200b\u884c\u200b\u7684\u200b <code>&lt;metricName&gt;_sum</code> \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6240\u6709\u200b observe \u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\uff0c\u200b\u7b2c\u200b 8 \u200b\u884c\u200b\u7684\u200b <code>&lt;metricName&gt;_count</code> \u200b\u8bb0\u5f55\u200b\u4e86\u200b observe \u200b\u7684\u200b\u603b\u91cf\u200b\u3002</p> <p>\u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b <code>http_request_duration_seconds(api=\"/foo\", method=\"GET\").observe(0.4)</code>\uff0c\u200b\u90a3\u4e48\u200b\u6570\u636e\u200b\u4f1a\u200b\u53d8\u4e3a\u200b\uff1a</p> <pre><code>http_request_duration_seconds_bucket{le=\"0.1\",api=\"/foo\",method=\"GET\"} 0\nhttp_request_duration_seconds_bucket{le=\"0.5\",api=\"/foo\",method=\"GET\"} 1\nhttp_request_duration_seconds_bucket{le=\"1.0\",api=\"/foo\",method=\"GET\"} 2\nhttp_request_duration_seconds_bucket{le=\"+Inf\",api=\"/foo\",method=\"GET\"} 2\n\nhttp_request_duration_seconds_sum{api=\"/foo\",method=\"GET\"} 1.2\n\nhttp_request_duration_seconds_count{api=\"/foo\",method=\"GET\"} 2\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8fd8\u6709\u200b <code>http_request_duration_seconds(api=\"/bar\", method=\"GET\").observe(1.2)</code>\uff0c\u200b\u90a3\u4e48\u200b\u4f1a\u200b\u65b0\u589e\u200b\u4e0e\u200b\u4e0a\u8ff0\u200b\u7c7b\u4f3c\u200b\u7684\u200b 6 \u200b\u4e2a\u200b time series\u3002</p> Summary <p>\u200b\u4e0e\u200b <code>Histogram</code> \u200b\u7c7b\u4f3c\u200b\uff0c<code>Summary</code> \u200b\u4e5f\u200b\u4f1a\u200b\u521b\u5efa\u200b\u4e00\u7cfb\u5217\u200b\u4e0d\u540c\u200b\u7684\u200b metric \u200b\u6765\u200b\u8bb0\u5f55\u200b\u89c2\u5bdf\u200b\u5f97\u5230\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u4f46\u200b\u5b83\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u4e0d\u540c\u200b\u7684\u200b\u5206\u200b\u4f4d\u6570\u200b (quantile) \u200b\u800c\u200b\u975e\u200b\u9884\u5148\u200b\u5b9a\u4e49\u200b\u7684\u200b bucket\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>http_request_duration_seconds{quantile=\"0.5\"} 0.232227334\nhttp_request_duration_seconds{quantile=\"0.90\"} 0.821139321\nhttp_request_duration_seconds{quantile=\"0.95\"} 1.528948804\nhttp_request_duration_seconds{quantile=\"0.99\"} 2.829188272\nhttp_request_duration_seconds{quantile=\"1\"} 34.283829292\n\nhttp_request_duration_seconds_sum 8953.332\nhttp_request_duration_seconds_count 27892\n</code></pre> <p>\u200b\u7531\u4e8e\u200b <code>Summary</code> \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u6d41\u5f0f\u200b\u7b97\u6cd5\u200b\u6765\u200b\u8ba1\u7b97\u200b\u5206\u200b\u4f4d\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u200b\u7684\u200b\u8ba1\u7b97\u200b\u91cf\u4f1a\u200b\u6bd4\u200b <code>Histogram</code> \u200b\u5927\u5f97\u591a\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b\u5982\u4f55\u200b\u9009\u62e9\u200b <code>Histogram</code> \u200b\u548c\u200b <code>Summary</code>\uff0c\u200b\u8bf7\u200b\u53c2\u8003\u200b Histograms and Summaries | Prometheus\u3002</p>"},{"location":"blog/prometheus/#2-querying--\u67e5\u8be2","title":"2 Querying | \u200b\u67e5\u8be2","text":"<p>Thanos</p> <p>\u200b\u672c\u6587\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b Prometheus\uff1b\u200b\u4f46\u200b\u5728\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4f7f\u7528\u200b Thanos \u200b\u6765\u200b\u6269\u5c55\u200b Prometheus \u200b\u7684\u200b\u529f\u80fd\u200b\u3002Thanos \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b\u957f\u671f\u200b\u5b58\u50a8\u200b\u3001\u200b\u67e5\u8be2\u200b\u4f18\u5316\u200b\u3001\u200b\u6570\u636e\u538b\u7f29\u200b\u7b49\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u96c6\u7fa4\u200b\u7684\u200b Prometheus \u200b\u8d1f\u8d23\u200b\u6536\u96c6\u200b\u6240\u5728\u200b\u96c6\u7fa4\u200b\u5404\u200b\u670d\u52a1\u200b\u7684\u200b metrics \u200b\u5e76\u200b\u63d0\u4f9b\u200b\u4e00\u5b9a\u200b\u7684\u200b\u67e5\u8be2\u200b\u80fd\u529b\u200b\uff1b\u200b\u800c\u200b Thanos \u200b\u4ee5\u200b sidecar \u200b\u7684\u200b\u5f62\u5f0f\u200b\u6574\u5408\u200b\u5404\u4e2a\u200b\u96c6\u7fa4\u200b\u7684\u200b Prometheus \u200b\u91c7\u96c6\u200b\u7684\u200b\u6307\u6807\u200b\u5e76\u200b\u957f\u671f\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u5e76\u200b\u540c\u6837\u200b\u9002\u7528\u200b PromQL \u200b\u67e5\u8be2\u200b\u3002</p>"},{"location":"blog/prometheus/#21-data-types--\u6570\u636e\u7c7b\u578b","title":"2.1 Data Types | \u200b\u6570\u636e\u7c7b\u578b","text":"<p>\u200b\u5728\u200b PromQL \u200b\u4e2d\u200b\uff0c\u200b\u5927\u591a\u6570\u200b\u8868\u8fbe\u5f0f\u200b\u5f52\u5c5e\u4e8e\u200b\u4ee5\u4e0b\u200b 3 \u200b\u79cd\u200b\u7c7b\u578b\u200b\u4e4b\u4e00\u200b\uff1a</p> <ul> <li>Scalar\uff1a\u200b\u5355\u4e2a\u200b\u6d6e\u70b9\u6570\u200b\u6570\u503c\u200b\uff1b</li> <li>Instant vector\uff1a\u200b\u4e00\u7ec4\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u5305\u542b\u200b\u5b83\u200b\u5728\u200b\u67e5\u8be2\u200b\u65f6\u95f4\u200b\u70b9\u524d\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u88ab\u200b\u91c7\u6837\u200b\u5230\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u4f8b\u5982\u200b Query <code>http_requests_total</code> \u200b\u6216\u8005\u200b <code>http_requests_total{method=\"GET\"}</code> \u200b\u8fd4\u56de\u200b\u5728\u200b query timestamp \u200b\u8fd9\u4e2a\u200b\u65f6\u95f4\u200b\u70b9\u200b\u4e4b\u524d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u88ab\u200b\u91c7\u6837\u200b\u5230\u200b\u7684\u200b\u503c\u200b\uff1b<ul> <li>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff1a\u200b\u5373\u4f7f\u200b <code>http_requests_total{method=\"GET\"}</code> \u200b\u5f97\u5230\u200b\u7684\u200b instant vector \u200b\u53ea\u200b\u5305\u542b\u200b 1 \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5b83\u200b\u4e5f\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u89c6\u4e3a\u200b scalar\u3002</li> </ul> </li> <li>Range vector\uff1a\u200b\u4e00\u7ec4\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u5305\u542b\u200b\u5b83\u200b\u5728\u200b\u67e5\u8be2\u200b\u65f6\u95f4\u6bb5\u200b\u5185\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u70b9\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>http_requests_total[5m]</code> \u200b\u8fd4\u56de\u200b\u5728\u200b 5 \u200b\u5206\u949f\u200b\u5185\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u503c\u200b\u3002</li> </ul> <p>\u200b\u5982\u679c\u200b\u6211\u4eec\u200b\u7528\u200b Python \u200b\u505a\u200b\u7c7b\u6bd4\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4e0a\u9762\u200b\u7684\u200b\u4e09\u4e2a\u200b\u7c7b\u578b\u200b\u53ef\u4ee5\u200b\u4ee5\u200b\u5982\u4e0b\u200b\u65b9\u5f0f\u200b\u8868\u793a\u200b\uff1a</p> <pre><code>type Scalar = float\n\ntype Labels = Dict[str, str]\ntype Sample = Tuple[Timestamp, Scalar]\n\ntype LabeledSample = Tuple[Labels, Sample]\ntype InstantVector = List[LabeledSample]\n\ntype TimeStamp = int\ntype TimeSeries = List[Sample]\ntype LabeledTimeSeries = Tuple[Labels, TimeSeries]\ntype RangeVector = List[LabeledTimeSeries]\n</code></pre>"},{"location":"blog/prometheus/#22-time-series-selectors--\u65f6\u95f4\u5e8f\u5217\u9009\u62e9\u5668","title":"2.2 Time Series Selectors | \u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u9009\u62e9\u5668","text":"<p>\u200b\u4ee5\u4e0b\u200b\u8868\u8fbe\u5f0f\u200b\u5177\u6709\u200b\u7c7b\u578b\u200b <code>InstantVector</code>\uff1a</p> <ul> <li><code>http_requests_total</code></li> <li><code>http_requests_total{method=\"GET\"}</code><ul> <li>\u200b\u5bf9\u4e8e\u200b\u6ca1\u6709\u200b\u88ab\u200b matchers \u200b\u63d0\u53ca\u200b\u7684\u200b label\uff0c\u200b\u5219\u200b\u4efb\u4f55\u200b\u503c\u200b\u5168\u90e8\u200b\u63a5\u53d7\u200b\u3002</li> <li>\u200b\u5bf9\u4e8e\u200b\u540c\u4e00\u4e2a\u200b label\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b matchers\uff0c\u200b\u5b83\u4eec\u200b\u4e4b\u95f4\u200b\u662f\u200b AND \u200b\u5173\u7cfb\u200b\u3002</li> </ul> </li> <li><code>{__name__=\"http_requests_total\", method=\"GET\"}</code><ul> <li><code>__name__</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b label\uff0c\u200b\u7528\u4e8e\u200b\u5339\u914d\u200b\u6307\u6807\u200b\u540d\u200b\u3002</li> <li>\u200b\u7531\u6b64\u53ef\u89c1\u200b\uff0cselector \u200b\u4e2d\u200b\u4e0d\u5fc5\u200b\u5305\u542b\u200b metric_name\u3002</li> <li>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8be5\u200b\u8868\u8fbe\u5f0f\u200b\u548c\u200b\u524d\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\u7b49\u4ef7\u200b\u3002</li> </ul> </li> <li><code>http_requests_total{api=~\"v1.*\", code!~\"20[0-9]\", method!=\"POST\"}</code><ul> <li><code>=</code> \u200b\u8868\u793a\u200b\u7cbe\u786e\u200b\u5339\u914d\u200b\uff0c<code>=~</code> \u200b\u8868\u793a\u200b\u6b63\u5219\u200b\u5339\u914d\u200b\uff0c<code>!=</code> \u200b\u548c\u200b <code>!~</code> \u200b\u8868\u793a\u200b\u4e0d\u200b\u5339\u914d\u200b\uff0c\u200b\u5206\u522b\u200b\u9002\u7528\u200b\u4e8e\u200b\u5b57\u7b26\u4e32\u200b\u548c\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b\u3002</li> <li>\u200b\u6b63\u5219\u8868\u8fbe\u5f0f\u200b\u662f\u200b fully anchored \u200b\u7684\u200b\uff0c\u200b\u5373\u200b <code>api=~\"v1.*\"</code> \u200b\u7b49\u4ef7\u200b\u4e8e\u200b <code>api=~\"^v1.*$\"</code>\u3002</li> </ul> </li> <li><code>http_requests_total offset 5m</code> / <code>http_requests_total{method=\"GET\"} offset 5m</code><ul> <li><code>offset</code> \u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u65f6\u95f4\u200b\u504f\u79fb\u91cf\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>offset 5m</code> \u200b\u8868\u793a\u200b\u5411\u524d\u200b\u504f\u79fb\u200b 5 \u200b\u5206\u949f\u200b\u3002</li> </ul> </li> <li><code>http_requests_total @ 1609746000</code> / <code>http_requests_total{method=\"GET\"} @ 1609746000</code><ul> <li><code>@</code> \u200b\u7528\u4e8e\u200b\u6307\u5b9a\u200b\u65f6\u95f4\u200b\u6233\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>@ 1609746000</code> \u200b\u8868\u793a\u200b\u5728\u200b\u65f6\u95f4\u200b\u6233\u200b 1609746000 \u200b\u7684\u200b\u65f6\u5019\u200b\u7684\u200b\u503c\u200b\u3002</li> </ul> </li> </ul> <p>\u200b\u54ea\u4e9b\u200b time series \u200b\u4f1a\u200b\u88ab\u200b\u5305\u542b\u200b\u5728\u200b\u67e5\u8be2\u200b\u7ed3\u679c\u200b\u4e2d\u200b\uff1f</p> <p>Prometheus \u200b\u914d\u7f6e\u200b\u4e86\u200b\u4e00\u4e2a\u200b staleness \u200b\u65f6\u200b\u957f\u200b\uff0c\u200b\u9ed8\u8ba4\u503c\u200b\u662f\u200b 5 \u200b\u5206\u949f\u200b\u3002</p> <p>\u200b\u5728\u200b\u4f7f\u7528\u200b Instant Vector Selector \u200b\u65f6\u200b\uff0c\u200b\u5728\u200b\u67e5\u8be2\u200b\u65f6\u95f4\u200b\u70b9\u524d\u200b staleness \u200b\u65f6\u957f\u200b\u7684\u200b\u8303\u56f4\u200b\u5185\u200b\u51fa\u73b0\u200b\u8fc7\u200b\u6570\u636e\u200b\u7684\u200b\u6240\u6709\u200b time series \u200b\u4f1a\u200b\u88ab\u200b\u5305\u542b\u200b\u5728\u200b\u7ed3\u679c\u200b\u7684\u200b <code>InstantVector</code> \u200b\u4e2d\u200b\uff1b\u200b\u5176\u503c\u200b\u662f\u200b\u8be5\u200b\u8303\u56f4\u200b\u5185\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u91c7\u6837\u200b\u5230\u200b\u7684\u200b\u503c\u200b\u3002</p> <p>\u200b\u4ee5\u4e0b\u200b\u8868\u8fbe\u5f0f\u200b\u5177\u6709\u200b\u7c7b\u578b\u200b <code>RangeVector</code>\uff1a</p> <ul> <li><code>http_requests_total[5m]</code></li> <li><code>http_requests_total{method=\"GET\"}[5m]</code></li> <li><code>http_requests_total{method=\"GET\"}[5m] offset 5m</code></li> <li><code>http_requests_total{method=\"GET\"}[5m] @ 1609746000</code></li> </ul> <p>\u200b\u54ea\u4e9b\u200b time series \u200b\u4f1a\u200b\u88ab\u200b\u5305\u542b\u200b\u5728\u200b\u67e5\u8be2\u200b\u7ed3\u679c\u200b\u4e2d\u200b\uff1f</p> <p>\u200b\u5bf9\u4e8e\u200b Range Vector Selector\uff0cPrometheus \u200b\u4f1a\u200b\u8fd4\u56de\u200b\u5728\u200b\u67e5\u8be2\u200b\u65f6\u95f4\u200b\u5185\u200b\u51fa\u73b0\u200b\u8fc7\u200b\u6570\u636e\u200b\u7684\u200b\u6240\u6709\u200b time series\uff1b\u200b\u5176\u503c\u200b\u662f\u200b\u5728\u200b\u67e5\u8be2\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u5185\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u70b9\u200b\u7684\u200b\u503c\u200b\u3002</p>"},{"location":"blog/prometheus/#23-operators--\u8fd0\u7b97\u7b26","title":"2.3 Operators | \u200b\u8fd0\u7b97\u7b26","text":""},{"location":"blog/prometheus/#231-\u7b97\u672f\u4e8c\u5143\u8fd0\u7b97\u7b26","title":"2.3.1 \u200b\u7b97\u672f\u200b\u4e8c\u5143\u200b\u8fd0\u7b97\u7b26","text":"<p>\u200b\u5305\u62ec\u200b <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code> (\u200b\u53d6\u6a21\u200b), <code>^</code> (\u200b\u5e42\u200b)\u3002\u200b\u5176\u200b\u884c\u4e3a\u200b\u662f\u200b\uff1a</p> <ul> <li><code>Scalar &lt;op&gt; Scalar</code>\uff1a\u200b\u548c\u200b\u6b63\u5e38\u200b\u7b97\u672f\u200b\u4e00\u81f4\u200b\uff1b</li> <li><code>InstantVector &lt;op&gt; Scalar</code>\uff1a\u200b\u8fd4\u56de\u200b\u5bf9\u200b InstantVector \u200b\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u5e94\u7528\u200b <code>&lt;op&gt;</code> \u200b\u7684\u200b\u7ed3\u679c\u200b\uff1bmetric_name (<code>__name__</code>) \u200b\u88ab\u200b\u5220\u9664\u200b\uff1b</li> <li><code>InstantVector1 &lt;op&gt; InstantVector2</code>\uff1a\u200b\u5bf9\u4e8e\u200b InstantVector1 \u200b\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5728\u200b InstantVector2 \u200b\u4e2d\u200b\u627e\u5230\u200b\u6807\u7b7e\u200b\u5b8c\u5168\u76f8\u540c\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u5c06\u200b\u5176\u200b\u5e94\u7528\u200b <code>&lt;op&gt;</code> \u200b\u7684\u200b\u7ed3\u679c\u200b\u8fd4\u56de\u200b\uff0cmetric_name (<code>__name__</code>) \u200b\u88ab\u200b\u5220\u9664\u200b\uff1b\u200b\u5982\u679c\u200b\u6ca1\u200b\u627e\u5230\u200b\uff0c\u200b\u5219\u200b\u7ed3\u679c\u200b\u4e2d\u200b\u4e0d\u200b\u5305\u542b\u200b\u8be5\u200b label\uff1b</li> <li>\u200b\u4e0d\u200b\u63a5\u53d7\u200b RangeVector\u3002</li> </ul>"},{"location":"blog/prometheus/#232-\u6bd4\u8f83\u4e8c\u5143\u8fd0\u7b97\u7b26","title":"2.3.2 \u200b\u6bd4\u8f83\u200b\u4e8c\u5143\u200b\u8fd0\u7b97\u7b26","text":"<p>\u200b\u5305\u62ec\u200b <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>\u3002\u200b\u5176\u200b\u884c\u4e3a\u200b\u662f\u200b\uff1a</p> <ul> <li><code>bool(Scalar &lt;op&gt; Scalar)</code>\uff1a\u200b\u8fd4\u56de\u200b 0 \u200b\u6216\u8005\u200b 1\uff1b</li> <li><code>InstantVector &lt;op&gt; Scalar</code>\uff1a\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bd4\u8f83\u200b\u7ed3\u679c\u200b\u4e3a\u200b\u771f\u7684\u200b\u5143\u7d20\u200b\u4fdd\u7559\u200b\uff0c\u200b\u5176\u4f59\u200b\u5220\u9664\u200b\uff1b</li> <li><code>bool(InstantVector &lt;op&gt; Scalar)</code>\uff1a\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u4e2d\u5c06\u200b\u6bd4\u8f83\u200b\u7ed3\u679c\u200b\u4e3a\u200b\u771f\u7684\u200b\u5143\u7d20\u200b\u7f6e\u200b\u4e3a\u200b 1\uff0c\u200b\u5176\u4f59\u200b\u7f6e\u200b\u4e3a\u200b 0\uff1bmetric_name (<code>__name__</code>) \u200b\u88ab\u200b\u5220\u9664\u200b\uff1b</li> <li><code>InstantVector1 &lt;op&gt; InstantVector2</code>\uff1aInstantVector2 \u200b\u4f5c\u4e3a\u200b\u8fc7\u6ee4\u5668\u200b\uff1aInstantVector1 \u200b\u5728\u200b\u5176\u4e2d\u200b\u627e\u200b\u4e0d\u5230\u200b\u6807\u7b7e\u200b\u5b8c\u5168\u76f8\u540c\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u6216\u8005\u200b\u5bf9\u5e94\u200b\u5143\u7d20\u200b\u6bd4\u8f83\u200b\u7ed3\u679c\u200b\u4e3a\u200b\u5047\u200b\u7684\u200b\uff0c\u200b\u5c06\u200b\u5176\u200b\u5220\u9664\u200b\uff1b</li> <li><code>bool(InstantVector1 &lt;op&gt; InstantVector2)</code>\uff1a\u200b\u7c7b\u4f3c\u200b\u524d\u200b\u4e00\u6761\u200b\uff1a\u200b\u4fdd\u7559\u200b\u7684\u200b\u5143\u7d20\u200b\u7f6e\u200b\u4e3a\u200b 1\uff0c\u200b\u5176\u4f59\u200b\u7f6e\u200b\u4e3a\u200b 0\uff1bmetric_name (<code>__name__</code>) \u200b\u88ab\u200b\u5220\u9664\u200b\uff1b</li> <li>\u200b\u4e0d\u200b\u63a5\u53d7\u200b RangeVector\u3002</li> </ul>"},{"location":"blog/prometheus/#233-\u903b\u8f91\u96c6\u5408\u4e8c\u5143\u8fd0\u7b97\u7b26","title":"2.3.3 \u200b\u903b\u8f91\u200b\uff08\u200b\u96c6\u5408\u200b\uff09\u200b\u4e8c\u5143\u200b\u8fd0\u7b97\u7b26","text":"<p>\u200b\u5305\u62ec\u200b <code>and</code>, <code>or</code>, <code>unless</code>\uff0c\u200b\u53ea\u200b\u5728\u200b <code>InstantVector</code> \u200b\u4e4b\u95f4\u200b\u5b9a\u4e49\u200b\u3002\u200b\u5176\u200b\u884c\u4e3a\u200b\u662f\u200b\uff1a</p> <ul> <li><code>iv1 and iv2</code> (intersection)\uff1a\u200b\u8fd4\u56de\u200b iv1 \u200b\u4e2d\u200b\u7684\u200b\u90a3\u4e9b\u200b\u5728\u200b iv2 \u200b\u4e2d\u200b\u5177\u6709\u200b\u5b8c\u5168\u76f8\u540c\u200b\u6807\u7b7e\u200b\u7684\u200b\u5143\u7d20\u200b\uff1b</li> <li><code>iv1 or iv2</code> (union)\uff1a\u200b\u8fd4\u56de\u200b iv1 \u200b\u7684\u200b\u6240\u6709\u200b\u5143\u7d20\u200b\uff0c\u200b\u4ee5\u53ca\u200b iv2 \u200b\u4e2d\u200b\u90a3\u4e9b\u200b\u5728\u200b iv1 \u200b\u4e2d\u200b\u6ca1\u6709\u200b\u5b8c\u5168\u76f8\u540c\u200b\u6807\u7b7e\u96c6\u200b\u7684\u200b\u5143\u7d20\u200b\uff1b</li> <li><code>iv1 unless iv2</code> (complement)\uff1a\u200b\u8fd4\u56de\u200b iv1 \u200b\u4e2d\u200b\u7684\u200b\u90a3\u4e9b\u200b\u5728\u200b iv2 \u200b\u4e2d\u200b\u6ca1\u6709\u200b\u5b8c\u5168\u76f8\u540c\u200b\u6807\u7b7e\u200b\u7684\u200b\u5143\u7d20\u200b\u3002</li> </ul>"},{"location":"blog/prometheus/#234-vector-matching","title":"2.3.4 Vector Matching","text":"<p>\u200b\u4e0a\u9762\u200b\u4e09\u8282\u200b\u4e2d\u200b\u63cf\u8ff0\u200b\u7684\u200b <code>InstantVector</code> \u200b\u4e4b\u95f4\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u90fd\u200b\u8bd5\u56fe\u200b\u4ece\u200b\u53f3\u8fb9\u200b\u7684\u200b <code>InstantVector</code> \u200b\u4e2d\u4e3a\u200b\u5de6\u8fb9\u200b\u7684\u200b <code>InstantVector</code> \u200b\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u627e\u5230\u200b\u6807\u7b7e\u200b\u5339\u914d\u200b\u7684\u200b\u5143\u7d20\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u300c\u200b\u5339\u914d\u200b\u300d\u200b\u8fc7\u7a0b\u200b\u4e5f\u200b\u662f\u200b\u53ef\u4ee5\u200b\u63a7\u5236\u200b\u7684\u200b\uff1a</p> <ul> <li><code>iv1 &lt;bin-op&gt; on(&lt;label-list&gt;) iv2</code> \u200b\u5c06\u200b\u7eb3\u5165\u200b\u8003\u8651\u200b\u7684\u200b\u6807\u7b7e\u200b\u9650\u5236\u200b\u5728\u200b <code>&lt;label-list&gt;</code> \u200b\u4e2d\u200b\uff0c\u200b\u5176\u4ed6\u200b\u6807\u7b7e\u200b\u5168\u90e8\u200b\u5ffd\u7565\u200b\uff1b</li> <li><code>iv1 &lt;bin-op&gt; ignoring(&lt;label-list&gt;) iv2</code> \u200b\u5c06\u200b\u5ffd\u7565\u200b <code>&lt;label-list&gt;</code> \u200b\u4e2d\u200b\u7684\u200b\u6807\u7b7e\u200b\uff0c\u200b\u5176\u4ed6\u200b\u6807\u7b7e\u200b\u5168\u90e8\u200b\u7eb3\u5165\u200b\u8003\u8651\u200b\u3002</li> </ul> <p>\u200b\u4e0b\u56fe\u200b\u5c55\u793a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <p></p> <p>\u200b\u53e6\u5916\u200b\u5728\u200b\u7b97\u672f\u200b\u548c\u200b\u6bd4\u8f83\u200b\u8fd0\u7b97\u7b26\u200b\u4e2d\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>group_left</code> \u200b\u548c\u200b <code>group_right</code> \u200b\u5b9e\u73b0\u200b\u4e00\u5bf9\u200b\u591a\u200b\u548c\u200b\u591a\u200b\u5bf9\u200b\u4e00\u200b\u7684\u200b\u5339\u914d\u200b\u3002\u200b\u672c\u6587\u200b\u6682\u4e14\u200b\u7565\u53bb\u200b\uff0c\u200b\u53c2\u89c1\u200b \u200b\u6587\u6863\u200b\u3002</p>"},{"location":"blog/prometheus/#235-\u805a\u5408\u8fd0\u7b97\u7b26","title":"2.3.5 \u200b\u805a\u5408\u200b\u8fd0\u7b97\u7b26","text":"<p>Note</p> <p>\u200b\u9664\u4e86\u200b <code>topk</code> \u200b\u548c\u200b <code>bottomk</code> \u200b\u4ee5\u5916\u200b\uff0c\u200b\u6240\u6709\u200b\u805a\u5408\u200b\u8fd0\u7b97\u7b26\u200b\u90fd\u200b\u4f1a\u200b\u5728\u200b\u7ed3\u679c\u200b\u4e2d\u200b\u5220\u9664\u200b metrics name (<code>__name__</code>)\uff0c\u200b\u56e0\u4e3a\u200b\u6240\u5f97\u200b\u7684\u200b\u503c\u200b\u7ecf\u8fc7\u200b\u4e86\u200b\u5904\u7406\u200b\uff0c\u200b\u800c\u200b\u539f\u6765\u200b metrics name \u200b\u4e0d\u518d\u200b\u6709\u200b\u610f\u4e49\u200b\u3002</p> <p>\u200b\u805a\u5408\u200b\u8fd0\u7b97\u7b26\u200b\u5c06\u200b InstantVector \u200b\u6309\u7167\u200b\u6807\u7b7e\u200b\u805a\u5408\u200b\u4e3a\u200b\u5143\u7d20\u200b\u66f4\u5c11\u200b\u7684\u200b InstantVector\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li><code>sum(http_requests_total)</code>\uff1a\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5355\u200b\u5143\u7d20\u200b\u7684\u200b InstantVector\uff0c\u200b\u6807\u7b7e\u200b\u4e3a\u200b <code>{}</code>\uff0c\u200b\u503c\u4e3a\u200b\u6240\u6709\u200b <code>http_requests_total</code> \u200b\u7684\u200b\u548c\u200b\uff1b</li> <li><code>sum(http_requests_total{method=\"GET\"})</code>\uff1a\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5355\u200b\u5143\u7d20\u200b\u7684\u200b InstantVector\uff0c\u200b\u6807\u7b7e\u200b\u4e3a\u200b <code>{}</code>\uff0c\u200b\u503c\u4e3a\u200b\u6240\u6709\u200b <code>http_requests_total{method=\"GET\"}</code> \u200b\u7684\u200b\u548c\u200b\uff1b</li> <li><code>sum(http_requests_total) by (method)</code>\uff1a\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b InstantVector\uff1b\u200b\u5bf9\u4e8e\u200b <code>http_requests_total</code> \u200b\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b <code>method</code>\uff0c\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u6807\u7b7e\u200b\u53ea\u6709\u200b <code>method</code>\uff0c\u200b\u503c\u4e3a\u200b\u6240\u6709\u200b\u5bf9\u5e94\u200b method \u200b\u7684\u200b <code>http_requests_total</code> \u200b\u7684\u200b\u548c\u200b\uff1b</li> <li><code>sum(http_requests_total) by (method, code)</code>\uff1a\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5bf9\u4e8e\u200b <code>(method, code)</code> \u200b\u7684\u200b\u6bcf\u79cd\u200b\u5b58\u5728\u200b\u7684\u200b\u7ec4\u5408\u200b\uff0c\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u3002</li> <li><code>sum(http_requests_total) without (method)</code>\uff1a\u200b\u4e0e\u200b <code>by</code> \u200b\u76f8\u53cd\u200b\uff1a\u200b\u5bf9\u4e8e\u200b\u9664\u4e86\u200b <code>method</code> \u200b\u4ee5\u5916\u200b\u7684\u200b\u6240\u6709\u200b\u6807\u7b7e\u200b\u7684\u200b\u6bcf\u79cd\u200b\u5b58\u5728\u200b\u7ec4\u5408\u200b\uff0c\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u3002<ul> <li>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u6807\u7b7e\u200b\u53ea\u6709\u200b <code>method, code, api</code> \u200b\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>by (method)</code> \u200b\u548c\u200b <code>without (code, api)</code> \u200b\u7b49\u4ef7\u200b\u3002</li> </ul> </li> </ul> <p>\u200b\u4ee5\u4e0a\u200b\u7684\u200b <code>without</code> \u200b\u548c\u200b <code>by</code> \u200b\u4e0d\u80fd\u200b\u5171\u7528\u200b\uff1b\u200b\u53e6\u5916\u200b <code>sum(v) by (&lt;labels&gt;)</code> \u200b\u548c\u200b <code>sum by (&lt;labels&gt;) (v)</code> \u200b\u662f\u200b\u7b49\u4ef7\u200b\u7684\u200b\u3002</p> <p>\u200b\u5373\u200b\uff1a\u200b\u6211\u4eec\u200b\u901a\u8fc7\u200b <code>by</code> \u200b\u6216\u8005\u200b <code>without</code> \u200b\u5c06\u200b InstantVector \u200b\u6309\u7167\u200b\u6807\u7b7e\u200b \u200b\u5206\u7ec4\u200b\uff0c\u200b\u7136\u540e\u200b\u5b8c\u6210\u200b\u805a\u5408\u200b\u64cd\u4f5c\u200b\uff1b\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b\u5206\u7ec4\u200b\uff0c\u200b\u5219\u200b\u8ba4\u4e3a\u200b\u6240\u6709\u200b\u6807\u7b7e\u200b\u5c5e\u4e8e\u200b\u4e00\u7ec4\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u805a\u5408\u200b\u8fd0\u7b97\u7b26\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li><code>sum</code>: \u200b\u6bcf\u7ec4\u200b\u4e2d\u200b\u6240\u6709\u200b\u5143\u7d20\u200b\u7684\u200b\u548c\u200b\uff1b</li> <li><code>max</code>, <code>min</code>, <code>avg</code>, <code>stddev</code>, <code>stdvar</code>: \u200b\u5206\u522b\u200b\u662f\u200b\u6700\u5927\u503c\u200b\u3001\u200b\u6700\u5c0f\u503c\u200b\u3001\u200b\u5e73\u5747\u503c\u200b\u3001\u200b\u6807\u51c6\u5dee\u200b\u3001\u200b\u65b9\u5dee\u200b\uff1b</li> <li><code>group</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u5168\u90e8\u200b\u4e3a\u200b 1\uff1b</li> <li><code>count</code>: \u200b\u6bcf\u7ec4\u200b\u4e2d\u200b\u5143\u7d20\u200b\u7684\u200b\u4e2a\u6570\u200b\u3002</li> </ul> <p>\u200b\u53e6\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u805a\u5408\u200b\u51fd\u6570\u200b\u542b\u6709\u200b\u53c2\u6570\u200b\uff0c\u200b\u5176\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\u5f62\u200b\u5982\u200b <code>count_values(\"api\", http_requests_total) by (code)</code>\uff0c\u200b\u8868\u793a\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b <code>code</code>\uff0c\u200b\u7edf\u8ba1\u200b label <code>api</code> \u200b\u7684\u200b\u4e0d\u540c\u200b\u503c\u200b\u7684\u200b\u4e2a\u6570\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u805a\u5408\u200b\u8fd0\u7b97\u7b26\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li><code>count_values(label, v)</code>: \u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b\u7ec4\u200b\uff0c\u200b\u7edf\u8ba1\u200b label \u200b\u7684\u200b\u4e0d\u540c\u200b\u503c\u200b\u7684\u200b\u4e2a\u6570\u200b\uff1b</li> <li><code>quantile(\u03c6, v)</code>: \u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b\u7ec4\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5176\u4e2d\u200b\u6240\u6709\u200b\u503c\u4e2d\u200b \u03c6 \u200b\u5206\u4f4d\u200b\u7684\u200b\u503c\u200b\u3002</li> </ul> <p>\u200b\u4e0e\u200b\u4e0a\u8ff0\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e24\u4e2a\u200b\u805a\u5408\u200b\u8fd0\u7b97\u7b26\u200b\u662f\u200b <code>topk</code> \u200b\u548c\u200b <code>bottomk</code>\uff0c\u200b\u5b83\u4eec\u200b\u4fdd\u7559\u200b\u6bcf\u7ec4\u200b\u4e2d\u200b\u7684\u200b\u524d\u200b k \u200b\u4e2a\u200b\u6216\u200b\u540e\u200b k \u200b\u4e2a\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"blog/prometheus/#24-functions--\u51fd\u6570","title":"2.4 Functions | \u200b\u51fd\u6570","text":"<p>Note</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff1a\u200b\u51e0\u4e4e\u200b\u6240\u6709\u200b\u7684\u200b\u51fd\u6570\u200b (\u200b\u9664\u4e86\u200b <code>sort</code>, <code>sort_desc</code>, <code>label_replace</code>) \u200b\u90fd\u200b\u4f1a\u200b\u5728\u200b\u7ed3\u679c\u200b\u4e2d\u200b\u5220\u9664\u200b metrics name (<code>__name__</code>)\uff0c\u200b\u56e0\u4e3a\u200b\u6240\u5f97\u200b\u7684\u200b\u503c\u200b\u7ecf\u8fc7\u200b\u4e86\u200b\u5904\u7406\u200b\uff0c\u200b\u800c\u200b\u539f\u6765\u200b metrics name \u200b\u4e0d\u518d\u200b\u6709\u200b\u610f\u4e49\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\uff0c\u200b\u6211\u4eec\u200b\u4f7f\u7528\u200b <code>IV</code> \u200b\u548c\u200b <code>RV</code> \u200b\u5206\u522b\u200b\u66ff\u4ee3\u200b <code>InstantVector</code> \u200b\u548c\u200b <code>RangeVector</code>\u3002</p>"},{"location":"blog/prometheus/#\u6570\u5b66\u8fd0\u7b97","title":"\u6570\u5b66\u200b\u8fd0\u7b97","text":"<ul> <li>\u3010\u200b\u7edd\u5bf9\u503c\u200b\u3011<code>abs(v: IV) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u7edd\u5bf9\u503c\u200b\u3002</li> <li>\u3010\u200b\u7b26\u53f7\u200b\u51fd\u6570\u200b\u3011<code>sgn(v: IV) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u6b63\u8d1f\u200b\u6027\u200b\uff0c\u200b\u5373\u200b 1\u30010\u3001-1\u3002</li> <li>\u3010\u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\u3011<code>ceil(v: IV) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\u3002</li> <li>\u3010\u200b\u5411\u4e0b\u200b\u53d6\u6574\u200b\u3011<code>floor(v: IV) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u5411\u4e0b\u200b\u53d6\u6574\u200b\u3002</li> <li>\u3010\u200b\u56db\u820d\u4e94\u5165\u200b\u3011<code>round(v: IV, to_nearest: Scalar = 1) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u56db\u820d\u4e94\u5165\u200b\u503c\u200b\uff0c\u200b\u53d6\u5230\u200b\u6700\u200b\u63a5\u8fd1\u200b\u7684\u200b <code>to_nearest</code> \u200b\u7684\u200b\u500d\u6570\u200b\uff1b<code>to_nearest</code> \u200b\u53ef\u4ee5\u200b\u662f\u200b\u5206\u6570\u200b\u3002</li> <li>\u3010\u200b\u6307\u6570\u200b\u3011<code>exp(v: IV) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u6307\u6570\u200b \\(e^x\\)\u3002</li> <li>\u3010\u200b\u81ea\u7136\u5bf9\u6570\u200b\u3011<code>ln(v: IV) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u81ea\u7136\u5bf9\u6570\u200b \\(\\ln(x)\\)\u3002</li> <li>\u3010\u200b\u5bf9\u6570\u200b\u3011<code>log2(v: IV) -&gt; IV</code>, <code>log10(v: IV) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u5bf9\u6570\u200b\u3002</li> <li>\u3010\u200b\u5e73\u65b9\u6839\u200b\u3011<code>sqrt(v: IV) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u539f\u6765\u200b\u5143\u7d20\u200b\u7684\u200b\u5e73\u65b9\u6839\u200b\u3002</li> <li>\u3010\u200b\u4e09\u89d2\u51fd\u6570\u200b\u3011\u200b\u53e6\u5916\u200b\u8fd8\u6709\u200b\u8fd9\u4e9b\u200b\u4e09\u89d2\u51fd\u6570\u200b\uff0c\u200b\u548c\u200b\u4e0a\u8ff0\u200b\u7c7b\u4f3c\u200b\uff1a<code>sin</code>, <code>cos</code>, <code>tan</code>, <code>asin</code>, <code>acos</code>, <code>atan</code>, <code>sinh</code>, <code>cosh</code>, <code>tanh</code>, <code>asinh</code>, <code>acosh</code>, <code>atanh</code>\u3002</li> <li>\u3010\u200b\u89d2\u5ea6\u200b\u548c\u200b\u5f27\u5ea6\u200b\u3011<code>deg(v: IV) -&gt; IV</code>, <code>rad(v: IV) -&gt; IV</code>: \u200b\u5c06\u200b\u89d2\u5ea6\u200b\u548c\u200b\u5f27\u5ea6\u200b\u76f8\u4e92\u200b\u8f6c\u6362\u200b\u3002</li> <li>\u3010\\(\\pi\\)\u3011<code>pi() -&gt; Scalar</code> \u200b\u8fd4\u56de\u200b \\(\\pi\\)\u3002</li> </ul>"},{"location":"blog/prometheus/#\u65f6\u95f4","title":"\u65f6\u95f4","text":"<ul> <li>\u3010\u200b\u6c42\u503c\u200b\u65f6\u200b\u7684\u200b\u65f6\u95f4\u200b\u3011<code>time() -&gt; Scalar</code>: \u200b\u8fd4\u56de\u200b\u8ba1\u7b97\u200b\u8868\u8fbe\u5f0f\u200b\u65f6\u200b\u7684\u200b\u65f6\u95f4\u200b\u6233\u200b\uff0c\u200b\u5373\u200b\u81ea\u200b UTC 1970 \u200b\u5e74\u200b 1 \u200b\u6708\u200b 1 \u200b\u65e5\u200b\u4ee5\u6765\u200b\u7684\u200b\u79d2\u6570\u200b\u3002</li> <li>\u3010\u200b\u65f6\u95f4\u200b\u6233\u200b\u3011<code>timestamp(v: IV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u65f6\u95f4\u200b\u6233\u200b\u3002</li> <li><code>day_of_month(v: IV = vector(time())) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u65f6\u95f4\u200b\u6233\u200b\u5728\u200b\u6240\u5728\u200b\u6708\u200b\u7684\u200b\u7b2c\u51e0\u5929\u200b\u3002<ul> <li>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u8fd8\u6709\u200b <code>day_of_week</code>, <code>day_of_year</code></li> </ul> </li> <li><code>hour(v: IV = vector(time())) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u65f6\u95f4\u200b\u6233\u200b\u7684\u200b\u5728\u200b\u6240\u5728\u200b\u5929\u4e2d\u200b\u7684\u200b\u5c0f\u65f6\u200b (0-23)\u3002<ul> <li>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u8fd8\u6709\u200b <code>minute</code>, <code>year</code>, <code>month</code></li> </ul> </li> <li><code>days_in_month(v: IV = vector(time())) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u65f6\u95f4\u200b\u6233\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6708\u4efd\u200b\u4e2d\u6709\u200b\u51e0\u5929\u200b\u3002</li> </ul>"},{"location":"blog/prometheus/#\u5224\u65ad\u662f\u5426\u4e3a\u7a7a","title":"\u5224\u65ad\u200b\u662f\u5426\u200b\u4e3a\u7a7a","text":"<ul> <li><code>absent(v: IV) -&gt; IV</code>: \u200b\u5982\u679c\u200b v \u200b\u6709\u200b\u4efb\u4f55\u200b\u5143\u7d20\u200b\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u7a7a\u200b vector\uff1b\u200b\u5426\u5219\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u503c\u4e3a\u200b 1 \u200b\u7684\u200b\u5355\u200b\u5143\u7d20\u200b vector\uff0clabel \u200b\u4e3a\u200b v \u200b\u4e2d\u200b\u5404\u200b\u5143\u7d20\u200b label \u200b\u7684\u200b\u5171\u540c\u200b\u90e8\u5206\u200b\u3002<ul> <li>\u200b\u7528\u4f8b\u200b\uff1a\u200b\u67e5\u8be2\u200b\u662f\u5426\u200b\u6709\u200b 500 \u200b\u9519\u8bef\u200b\uff1a<code>absent(http_requests_total{code=\"500\"})</code></li> </ul> </li> <li><code>absent_over_time(v: RV) -&gt; IV</code>: \u200b\u5982\u679c\u200b v \u200b\u5728\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u5185\u6709\u200b\u4efb\u4f55\u200b\u5143\u7d20\u200b\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u7a7a\u200b vector\uff1b\u200b\u5426\u5219\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u503c\u4e3a\u200b 1 \u200b\u7684\u200b\u5355\u200b\u5143\u7d20\u200b vector\uff0clabel \u200b\u4e3a\u200b v \u200b\u4e2d\u200b\u5404\u200b\u5143\u7d20\u200b label \u200b\u7684\u200b\u5171\u540c\u200b\u90e8\u5206\u200b<ul> <li>\u200b\u7528\u4f8b\u200b\uff1a\u200b\u67e5\u8be2\u200b\u6700\u8fd1\u200b 5 \u200b\u5206\u949f\u200b\u662f\u5426\u200b\u6709\u200b 500 \u200b\u9519\u8bef\u200b\uff1a<code>absent_over_time(http_requests_total{code=\"500\"}[5m])</code></li> </ul> </li> </ul>"},{"location":"blog/prometheus/#\u9650\u5236\u6837\u672c\u503c","title":"\u9650\u5236\u200b\u6837\u672c\u200b\u503c","text":"<ul> <li><code>clamp(v: IV, min: Scalar, max: Scalar) -&gt; IV</code>: \u200b\u7ed3\u679c\u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u5982\u679c\u200b\u5c0f\u4e8e\u200b min\uff0c\u200b\u5219\u200b\u53d6\u200b min\uff1b\u200b\u5982\u679c\u200b\u5927\u4e8e\u200b max\uff0c\u200b\u5219\u200b\u53d6\u200b max\uff1b\u200b\u5426\u5219\u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b\u3002<ul> <li>\u200b\u7279\u522b\u200b\u5730\u200b\uff1a\u200b\u5982\u679c\u200b min &gt; max\uff0c\u200b\u5219\u200b\u8fd4\u56de\u200b\u4e00\u4e2a\u200b\u7a7a\u200b vector\uff1b\u200b\u5982\u679c\u200b min \u200b\u6216\u200b max \u200b\u662f\u200b NaN\uff0c\u200b\u5219\u200b\u7ed3\u679c\u200b\u4e3a\u200b NaN\u3002</li> </ul> </li> <li><code>clamp_max(v: IV, max: Scalar) -&gt; IV</code>, <code>clamp_min(v: IV, min: Scalar) -&gt; IV</code>: \u200b\u4e0e\u200b\u524d\u200b\u4e00\u6761\u200b\u7c7b\u4f3c\u200b\u3002</li> </ul>"},{"location":"blog/prometheus/#\u53d8\u5316\u60c5\u51b5","title":"\u53d8\u5316\u200b\u60c5\u51b5","text":"<ul> <li>\u3010\u200b\u53d8\u5316\u200b\u6b21\u6570\u200b\u3011<code>changes(v: RV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u53d8\u5316\u200b\u6b21\u6570\u200b\u3002<ul> <li>\u200b\u7528\u4f8b\u200b\uff1a\u200b\u67e5\u8be2\u200b\u6700\u8fd1\u200b 5 \u200b\u5206\u949f\u200b 500 \u200b\u9519\u8bef\u200b\u7684\u200b\u53d8\u5316\u200b\u6b21\u6570\u200b\uff1a<code>changes(http_requests_total{code=\"500\"}[5m])</code></li> </ul> </li> <li>\u3010\u200b\u5dee\u503c\u200b\u3011<code>delta(v: RV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u6700\u540e\u200b\u4e24\u4e2a\u200b\u6837\u672c\u200b\u503c\u200b\u7684\u200b\u5dee\u503c\u200b\u3002<ul> <li>\u200b\u7528\u4f8b\u200b\uff1a\u200b\u67e5\u8be2\u200b\u6700\u8fd1\u200b 5 \u200b\u5206\u949f\u200b 500 \u200b\u9519\u8bef\u200b\u7684\u200b\u5dee\u503c\u200b\uff1a<code>delta(http_requests_total{code=\"500\"}[5m])</code></li> <li>\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u662f\u975e\u200b\u6574\u6570\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5fc5\u8981\u200b\u65f6\u4f1a\u200b\u8fdb\u884c\u200b\u63d2\u503c\u200b\u3002</li> </ul> </li> <li>\u3010\u200b\u589e\u91cf\u200b\u3011<code>increase(v: RV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u589e\u91cf\u200b\u3002\u200b\u8fd9\u200b\u53ea\u200b\u5e94\u200b\u88ab\u200b\u7528\u4e8e\u200b Counter \u200b\u7c7b\u578b\u200b\u7684\u200b\u6307\u6807\u200b (\u200b\u4f46\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u68c0\u67e5\u200b)\u3002<ul> <li>\u200b\u5b83\u200b\u548c\u200b <code>delta</code> \u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff1a\u200b\u5982\u679c\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u5185\u200b\u6307\u6807\u200b\u56e0\u4e3a\u200b\u91cd\u542f\u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u539f\u56e0\u200b\u800c\u200b\u7834\u574f\u200b\u4e86\u200b\u5355\u8c03\u200b\u6027\u200b\uff0c<code>increase</code> \u200b\u4f1a\u200b\u52a0\u4ee5\u200b\u8865\u507f\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>0 -&gt; 10 -&gt; 2 -&gt; 15</code> \u200b\u4f1a\u200b\u88ab\u200b\u8865\u507f\u200b\u4e3a\u200b <code>0 -&gt; 10 -&gt; 12 -&gt; 25</code>\u3002</li> <li>\u200b\u7528\u4f8b\u200b\uff1a\u200b\u67e5\u8be2\u200b\u6700\u8fd1\u200b 5 \u200b\u5206\u949f\u200b 500 \u200b\u9519\u8bef\u200b\u7684\u200b\u589e\u91cf\u200b\uff1a<code>increase(http_requests_total{code=\"500\"}[5m])</code></li> </ul> </li> <li>\u3010\u200b\u77ac\u65f6\u200b\u5dee\u503c\u200b\u3011<code>idelta(v: RV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u6700\u540e\u200b\u4e24\u4e2a\u200b\u6837\u672c\u200b\u503c\u200b\u7684\u200b\u5dee\u503c\u200b\u3002\u200b\u8fd9\u200b\u53ea\u200b\u5e94\u200b\u88ab\u200b\u7528\u4e8e\u200b Gauge \u200b\u7c7b\u578b\u200b\u7684\u200b\u6307\u6807\u200b (\u200b\u4f46\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u68c0\u67e5\u200b)\u3002</li> <li>\u3010\u200b\u5bfc\u6570\u200b\u3011<code>deriv(v: RV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7528\u200b \u200b\u7b80\u5355\u200b\u7ebf\u6027\u200b\u56de\u5f52\u200b \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5bfc\u6570\u200b\u3002\u200b\u8fd9\u200b\u53ea\u200b\u5e94\u200b\u88ab\u200b\u7528\u4e8e\u200b Gauge \u200b\u7c7b\u578b\u200b\u7684\u200b\u6307\u6807\u200b (\u200b\u4f46\u200b\u5e76\u200b\u4e0d\u4f1a\u200b\u68c0\u67e5\u200b)\u3002<ul> <li>\u200b\u7528\u4f8b\u200b\uff1a\u200b\u67e5\u8be2\u200b\u6700\u8fd1\u200b 5 \u200b\u5206\u949f\u200b 500 \u200b\u9519\u8bef\u200b\u7684\u200b\u53d8\u5316\u7387\u200b\uff1a<code>deriv(http_requests_total{code=\"500\"}[5m])</code></li> </ul> </li> <li>\u3010Smoothing\u3011<code>holt_winters(v: RV, sf: Scalar, tf: Scalar) -&gt; IV</code>: \u200b\u4f7f\u7528\u200b Holt-Winters \u200b\u6307\u6570\u200b\u5e73\u6ed1\u200b\u7b97\u6cd5\u200b\u5bf9\u200b v \u200b\u8fdb\u884c\u200b\u5e73\u6ed1\u200b\u5904\u7406\u200b\u3002sf \u200b\u548c\u200b tf \u200b\u5206\u522b\u200b\u662f\u200b\u5e73\u6ed1\u200b\u56e0\u5b50\u200b\u548c\u200b\u65f6\u95f4\u200b\u56e0\u5b50\u200b\u3002</li> <li>\u3010\u200b\u589e\u957f\u7387\u200b\u3011<code>rate(v: RV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u589e\u957f\u7387\u200b\u3002\u200b\u8fd9\u200b\u53ea\u200b\u5e94\u200b\u88ab\u200b\u7528\u4e8e\u200b Counter \u200b\u7c7b\u578b\u200b\u7684\u200b\u6307\u6807\u200b\u3002\u200b\u5982\u679c\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u5185\u200b\u6307\u6807\u200b\u56e0\u4e3a\u200b\u91cd\u542f\u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u539f\u56e0\u200b\u800c\u200b\u7834\u574f\u200b\u4e86\u200b\u5355\u8c03\u200b\u6027\u200b\uff0c\u200b\u4f1a\u200b\u52a0\u4ee5\u200b\u8865\u507f\u200b\u3002<ul> <li>\u200b\u7528\u4f8b\u200b\uff1a\u200b\u67e5\u8be2\u200b\u6700\u8fd1\u200b 5 \u200b\u5206\u949f\u200b 500 \u200b\u9519\u8bef\u200b\u7684\u200b\u589e\u957f\u7387\u200b\uff1a<code>rate(http_requests_total{code=\"500\"}[5m])</code></li> </ul> </li> <li>\u3010\u200b\u77ac\u65f6\u200b\u589e\u957f\u7387\u200b\u3011<code>irate(v: RV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u57fa\u4e8e\u200b\u6700\u540e\u200b\u4e24\u4e2a\u200b\u6837\u672c\u200b\u503c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u7684\u200b\u77ac\u65f6\u200b\u589e\u957f\u7387\u200b\u3002\u200b\u8fd9\u200b\u53ea\u200b\u5e94\u200b\u88ab\u200b\u7528\u4e8e\u200b\u7ed8\u5236\u200b\u4e0d\u200b\u7a33\u5b9a\u200b\u7684\u200b\u3001\u200b\u5feb\u901f\u589e\u957f\u200b\u7684\u200b counters\u3002\u200b\u5982\u679c\u200b\u65f6\u95f4\u200b\u8303\u56f4\u200b\u5185\u200b\u6307\u6807\u200b\u56e0\u4e3a\u200b\u91cd\u542f\u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u539f\u56e0\u200b\u800c\u200b\u7834\u574f\u200b\u4e86\u200b\u5355\u8c03\u200b\u6027\u200b\uff0c\u200b\u4f1a\u200b\u52a0\u4ee5\u200b\u8865\u507f\u200b\u3002</li> <li>\u3010\u200b\u7ebf\u6027\u200b\u9884\u6d4b\u200b\u3011<code>predict_linear(v: RV, t: Scalar) -&gt; IV</code>: \u200b\u57fa\u4e8e\u200b \u200b\u7b80\u5355\u200b\u7ebf\u6027\u200b\u56de\u5f52\u200b\uff0c\u200b\u9884\u6d4b\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u5728\u200b t \u200b\u79d2\u200b\u540e\u200b\u7684\u200b\u503c\u200b\u3002</li> <li>\u3010\u200b\u91cd\u7f6e\u200b\u6b21\u6570\u200b\u3011<code>resets(v: RV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u91cd\u7f6e\u200b\u6b21\u6570\u200b\uff08\u200b\u4e24\u6b21\u200b\u8fde\u7eed\u200b\u91c7\u6837\u200b\u4e2d\u200b\u7684\u200b\u4efb\u4f55\u200b\u51cf\u5c11\u200b\u90fd\u200b\u88ab\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u91cd\u7f6e\u200b\uff09\u3002\u200b\u8fd9\u200b\u53ea\u200b\u5e94\u200b\u88ab\u200b\u7528\u4e8e\u200b Counter \u200b\u7c7b\u578b\u200b\u7684\u200b\u6307\u6807\u200b\u3002</li> </ul>"},{"location":"blog/prometheus/#\u6807\u7b7e\u64cd\u4f5c","title":"\u6807\u7b7e\u200b\u64cd\u4f5c","text":"<ul> <li>\u3010\u200b\u6807\u7b7e\u200b\u66ff\u6362\u200b\u3011<code>label_replace(v: IV, dst_label: String, replacement: String, src_label: String, regex: String) -&gt; IV</code>: \u200b\u5bf9\u4e8e\u200b v \u200b\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b time series\uff0c\u200b\u5982\u679c\u200b\u5176\u200b\u6807\u7b7e\u200b <code>src_label</code> \u200b\u7684\u200b\u503c\u200b\u5339\u914d\u200b <code>regex</code>\uff0c\u200b\u5219\u200b\u5c06\u200b\u5176\u200b\u66ff\u6362\u200b\u4e3a\u200b <code>replacement</code>\uff0c\u200b\u653e\u5230\u200b <code>dst_label</code> \u200b\u4e2d\u200b\uff1b\u200b\u5982\u679c\u200b\u4e0d\u200b\u5339\u914d\u200b\uff0c\u200b\u5219\u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b\u3002<code>replacement</code> \u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>$1</code>, <code>$2</code>, ... \u200b\u6765\u200b\u5f15\u7528\u200b <code>regex</code> \u200b\u4e2d\u200b\u7684\u200b\u5206\u7ec4\u200b\u3002<ul> <li>\u200b\u4f8b\u5982\u200b\uff0c<code>label_replace(http_requests_total{method=\"GET\"}, \"new_label\", \"$1\", \"api\", \"(.*)/.*\")</code> \u200b\u4f1a\u200b\u5c06\u200b <code>http_requests_total{api=\"a/b\"}</code> \u200b\u8f6c\u6362\u200b\u4e3a\u200b <code>http_requests_total{new_label=\"a\"}</code>\u3002</li> </ul> </li> <li>\u3010\u200b\u6807\u7b7e\u200b\u8fde\u63a5\u200b\u3011<code>label_join(v: IV, dst_label: String, separator: String, src_label_1: String, src_label_2: String, ...) -&gt; IV</code>: \u200b\u5c06\u200b v \u200b\u4e2d\u200b\u7684\u200b\u6807\u7b7e\u200b src_label_1, src_label_2, ... \u200b\u7684\u200b\u503c\u200b\u8fde\u63a5\u8d77\u6765\u200b\uff0c\u200b\u7528\u200b separator \u200b\u5206\u9694\u200b\uff0c\u200b\u653e\u5230\u200b dst_label \u200b\u4e2d\u200b\u3002<ul> <li>\u200b\u4f8b\u5982\u200b\uff0c<code>label_join(http_requests_total{method=\"GET\"}, \"new_label\", \"-\", \"method\", \"code\")</code> \u200b\u4f1a\u200b\u5c06\u200b <code>http_requests_total{method=\"GET\", code=\"200\"}</code> \u200b\u8f6c\u6362\u200b\u4e3a\u200b <code>http_requests_total{new_label=\"GET-200\"}</code>\u3002</li> </ul> </li> </ul>"},{"location":"blog/prometheus/#\u7c7b\u578b\u8f6c\u6362","title":"\u7c7b\u578b\u8f6c\u6362","text":"<ul> <li>\u3010\u200b\u7c7b\u578b\u8f6c\u6362\u200b\u3011<code>scalar(v: IV) -&gt; Scalar</code>: \u200b\u5982\u679c\u200b v \u200b\u6070\u6709\u200b 1 \u200b\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u8fd4\u56de\u200b\u5176\u503c\u200b\uff1b\u200b\u5426\u5219\u200b\u8fd4\u56de\u200b NaN\u3002</li> <li>\u3010\u200b\u7c7b\u578b\u8f6c\u6362\u200b\u3011<code>vector(s: Scalar) -&gt; IV</code>: \u200b\u5c06\u200b s \u200b\u8f6c\u6362\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u5176\u503c\u200b\u4e3a\u200b s\uff0c\u200b\u6ca1\u6709\u200b\u6807\u7b7e\u200b\u3002</li> </ul>"},{"location":"blog/prometheus/#\u6392\u5e8f","title":"\u6392\u5e8f","text":"<ul> <li>\u3010\u200b\u6392\u5e8f\u200b\u3011<code>sort(v: IV) -&gt; IV</code>, <code>sort_desc(v: IV) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u7684\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u6309\u7167\u200b\u503c\u200b\u6392\u5e8f\u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002</li> <li>\u3010\u200b\u6309\u200b label \u200b\u6392\u5e8f\u200b\u3011<code>sort_by_label(v: IV, label: String, ...) -&gt; IV</code>, <code>sort_by_label_desc(v: IV, label: String, ...) -&gt; IV</code>: \u200b\u8fd4\u56de\u200b v \u200b\u4e2d\u200b\u7684\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u6309\u7167\u200b\u6307\u5b9a\u200b <code>label</code> \u200b\u6392\u5e8f\u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1b\u200b\u5982\u679c\u200b\u6807\u7b7e\u200b\u4e00\u81f4\u200b\uff0c\u200b\u6309\u200b\u6837\u672c\u200b\u503c\u200b\u6392\u5e8f\u200b\u3002<ul> <li>\u200b\u6392\u5e8f\u200b\u91c7\u7528\u200b natural sort order\uff0c\u200b\u5373\u200b <code>z2</code> \u200b\u6392\u200b\u5728\u200b <code>z11</code> \u200b\u4e4b\u524d\u200b\u3002</li> </ul> </li> </ul>"},{"location":"blog/prometheus/#\u7528\u4e8e-rv-\u7684\u805a\u5408","title":"\u7528\u4e8e\u200b RV \u200b\u7684\u200b\u805a\u5408","text":"<p><code>&lt;aggregation&gt;_over_time(v: RV) -&gt; IV</code>: \u200b\u968f\u200b\u65f6\u95f4\u200b\u805a\u5408\u200b v \u200b\u4e2d\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u3002<code>&lt;aggregation&gt;</code> \u200b\u53ef\u4ee5\u200b\u662f\u200b\u7ed9\u5b9a\u200b\u533a\u95f4\u200b\u5185\u200b\u7684\u200b\uff1a</p> <ul> <li><code>avg</code>\uff1a\u200b\u5e73\u5747\u503c\u200b\uff1b</li> <li><code>min</code>\uff1a\u200b\u6700\u5c0f\u503c\u200b\uff1b</li> <li><code>max</code>\uff1a\u200b\u6700\u5927\u503c\u200b\uff1b</li> <li><code>sum</code>\uff1a\u200b\u548c\u200b\uff1b</li> <li><code>count</code>\uff1a\u200b\u8ba1\u6570\u200b\uff1b</li> <li><code>quantile_over_time(\u03c6: Scalar, v: RV) -&gt; IV</code>\uff1a\u200b\u7ed9\u5b9a\u200b\u533a\u95f4\u200b\u5185\u200b\u7684\u200b \u03c6 \u200b\u5206\u200b\u4f4d\u6570\u200b\uff1b</li> <li><code>stddev</code>\uff1a\u200b\u6807\u51c6\u5dee\u200b\uff1b</li> <li><code>stdvar</code>\uff1a\u200b\u65b9\u5dee\u200b\uff1b</li> <li><code>last</code>\uff1a\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u503c\u200b\uff1b</li> <li><code>present</code>\uff1a\u200b\u8fd4\u56de\u200b\u6240\u6709\u200b\u51fa\u73b0\u200b\u8fc7\u200b\u7684\u200b\u6807\u7b7e\u200b\u503c\u200b\uff0c\u200b\u503c\u5747\u200b\u4e3a\u200b 1\u3002</li> </ul>"},{"location":"blog/prometheus/#\u76f4\u65b9\u56fe\u76f8\u5173\u51fd\u6570","title":"\u76f4\u65b9\u56fe\u200b\u76f8\u5173\u200b\u51fd\u6570","text":"<p>TODO</p>"},{"location":"blog/prometheus/#25-subqueries--\u5b50\u67e5\u8be2","title":"2.5 Subqueries | \u200b\u5b50\u200b\u67e5\u8be2","text":"<p>\u200b\u67e5\u8be2\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u5305\u542b\u200b\u5b50\u200b\u67e5\u8be2\u200b\u3002\u200b\u4f8b\u5982\u200b <code>max_over_time(deriv(rate(distance_covered_total[5s])[30s:5s])[10m:])</code>\uff0c\u200b\u6211\u4eec\u200b\u7531\u5185\u800c\u5916\u200b\u5730\u200b\u89e3\u91ca\u200b\u8fd9\u4e2a\u200b\u67e5\u8be2\u200b\u7684\u200b\u542b\u4e49\u200b\uff1a</p> <ul> <li><code>[rv1]</code>: <code>distance_covered_total[5s]</code>\uff1a<code>RV</code>, \u200b\u53d6\u200b <code>distance_covered_total</code> 5s \u200b\u5185\u200b\u7684\u200b\u91c7\u6837\u200b\u503c\u200b<ul> <li>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u300c5s \u200b\u7684\u200b\u5404\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u65f6\u200b\u5185\u200b (\u200b\u5404\u4e2a\u200b label \u200b\u6807\u8bb0\u200b\u7684\u200b\uff0c\u200b\u4e0b\u540c\u200b) \u200b\u8f66\u8f86\u200b\u884c\u8fdb\u200b\u7684\u200b\u8ddd\u79bb\u200b\u300d</li> </ul> </li> <li><code>[iv2]</code>: <code>rate(rv1)</code>: <code>IV</code>\uff0c\u200b\u8ba1\u7b97\u200b <code>rv1</code> \u200b\u7684\u200b\u589e\u957f\u7387\u200b<ul> <li>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u300c5s \u200b\u5185\u200b\u7684\u200b\u8f66\u8f86\u200b\u884c\u8fdb\u200b\u7684\u200b\u8ddd\u79bb\u200b\u7684\u200b\u589e\u957f\u7387\u200b\u300d\uff0c\u200b\u5373\u200b\u300c5s \u200b\u5185\u200b\u8f66\u8f86\u200b\u7684\u200b\u901f\u5ea6\u200b\u300d</li> </ul> </li> <li><code>[rv3]</code>: <code>iv2[30s:5s]</code>: <code>RV</code>, \u200b\u53d6\u200b\u589e\u957f\u7387\u200b\u8fd1\u200b 30s \u200b\u7684\u200b\u91c7\u6837\u200b\u503c\u200b\uff0c\u200b\u5206\u8fa8\u7387\u200b\u4e3a\u200b 5s<ul> <li>\u200b\u5206\u8fa8\u7387\u200b (resolution) \u200b\u662f\u200b\u6307\u200b\u591a\u5c11\u200b\u79d2\u200b\u4e00\u4e2a\u200b\u6837\u672c\u200b\u3002\u200b\u5373\u200b\uff0c<code>rv3</code> \u200b\u7531\u200b <code>iv2</code> \u200b\u8fd1\u200b 30s \u200b\u5185\u200b\u6bcf\u200b 5s \u200b\u505a\u200b\u4e00\u6b21\u200b\u67e5\u8be2\u200b\u7684\u200b\u7ed3\u679c\u200b\u7ec4\u6210\u200b</li> <li>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u300c\u200b\u8fd1\u200b 30s \u200b\u5185\u200b\u6bcf\u200b 5s \u200b\u7684\u200b\u8f66\u8f86\u200b\u901f\u5ea6\u200b\u300d</li> </ul> </li> <li><code>[iv4]</code>: <code>deriv(rv3)</code>: <code>IV</code>\uff0c\u200b\u8ba1\u7b97\u200b <code>rv3</code> \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u5bfc\u6570\u200b<ul> <li>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u300c\u200b\u8fd1\u200b 30s \u200b\u5185\u200b\u8f66\u8f86\u200b\u901f\u5ea6\u200b\u7684\u200b\u53d8\u5316\u7387\u200b\u300d\uff0c\u200b\u5373\u200b\u300c30s \u200b\u5185\u200b\u8f66\u8f86\u200b\u7684\u200b\u52a0\u901f\u5ea6\u200b\u300d</li> </ul> </li> <li><code>[rv5]</code>: <code>iv4[10m:]</code>: <code>RV</code>, \u200b\u53d6\u200b <code>iv4</code> \u200b\u8fd1\u200b 10m \u200b\u7684\u200b\u91c7\u6837\u200b\u503c\u200b<ul> <li><code>iv4[10m:]</code> \u200b\u8868\u793a\u200b\u53d6\u200b <code>iv4</code> \u200b\u4e2d\u200b\u6700\u8fd1\u200b 10m \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5206\u8fa8\u7387\u200b\u4e3a\u200b\u67e5\u8be2\u200b\u7684\u200b\u9ed8\u8ba4\u8bbe\u7f6e\u200b</li> <li>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u300c\u200b\u8fd1\u200b 10 \u200b\u5206\u949f\u200b\u5185\u200b\u5404\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u7684\u200b\u8f66\u8f86\u200b\u7684\u200b\u52a0\u901f\u5ea6\u200b\u300d</li> </ul> </li> <li><code>[iv6]</code>: <code>max_over_time(rv5)</code>: <code>IV</code>\uff0c\u200b\u8ba1\u7b97\u200b <code>rv5</code> \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b\u65f6\u95f4\u200b\u5e8f\u5217\u200b\u7684\u200b\u6700\u5927\u503c\u200b<ul> <li>\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u300c\u200b\u8fd1\u200b 10 \u200b\u5206\u949f\u200b\u5185\u200b\u8f66\u8f86\u200b\u7684\u200b\u6700\u5927\u200b\u52a0\u901f\u5ea6\u200b\u300d</li> </ul> </li> </ul>"},{"location":"blog/prometheus/#26-api","title":"2.6 API","text":""},{"location":"blog/prometheus/#261-\u5373\u65f6\u67e5\u8be2","title":"2.6.1 \u200b\u5373\u65f6\u200b\u67e5\u8be2","text":"<p>\u200b\u5373\u65f6\u200b\u67e5\u8be2\u200b\u83b7\u53d6\u200b Query \u200b\u5728\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\u6216\u200b\u7ed9\u5b9a\u200b\u65f6\u95f4\u200b\u70b9\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1b\u200b\u63a5\u53e3\u200b\u4e3a\u200b <code>/query</code>\uff0c\u200b\u53c2\u6570\u200b\u5305\u62ec\u200b <code>query</code>, <code>time</code> \u200b\u548c\u200b <code>timeout</code>\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>INSTANT_QUERY = \"query/\"\n\ndef instant_query(promql: str, time: Optional[str] = None, timeout: Optional[str] = None):\n    url = f\"{API}{INSTANT_QUERY}\"\n    params = {\n        \"query\": promql,\n        \"time\": time,\n        \"timeout\": timeout\n    }\n    response = requests.get(url, params=params)\n    if not response.ok:\n        raise requests.HTTPError(f\"Failed to query {url}: {response.text}\")\n    return response.json()\n\npromql = '''sum(fastapi_requests_total{path!=\"/metrics\"}) by (path)'''\ntime = \"2024-07-01T20:00:00.000Z\" # rfc3339 OR unix_timestamp\ntimeout = \"10s\"\nresult = instant_query(promql, time, timeout)\npprint(result)\n</code></pre> <p></p> <p>(<code>pprint</code> \u200b\u6765\u81ea\u200b <code>rich.pretty</code>\u3002)</p> <p>\u200b\u4f7f\u7528\u200b POST \u200b\u4e5f\u200b\u80fd\u591f\u200b\u8fdb\u884c\u200b\u67e5\u8be2\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>def instant_query(promql: str, time: Optional[str] = None, timeout: Optional[str] = None):\n    url = f\"{API}{INSTANT_QUERY}\"\n    data = {\n        \"query\": promql,\n        \"time\": time,\n        \"timeout\": timeout\n    }\n    response = requests.post(url, data=data)\n    if not response.ok:\n        raise requests.HTTPError(f\"Failed to query {url}: {response.text}\")\n    return response.json()\n\nresult = instant_query(promql, time, timeout)\npprint(result)\n</code></pre> <p></p> <p>\u200b\u67e5\u8be2\u200b\u7684\u200b\u7ed3\u679c\u200b\u4e2d\u6709\u200b\u4e00\u4e2a\u200b <code>resultType</code>\uff0c\u200b\u8868\u793a\u200b\u7ed3\u679c\u200b\u7684\u200b\u7c7b\u578b\u200b\u3002\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u662f\u200b <code>string</code>, <code>scalar</code>, <code>vector</code> (\u200b\u8868\u793a\u200b Instant Vector), <code>matrix</code> (\u200b\u8868\u793a\u200b Range Vector) \u200b\u4e4b\u4e00\u200b\u3002\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u6211\u4eec\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u67e5\u8be2\u200b RangeVector\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>promql = '''sum(fastapi_requests_total{path=~\"/[^/]*\"}) by (path) [10m:2m]'''\n\nresult = instant_query(promql, time, timeout)\npprint(result)\n</code></pre> <p></p> <p>\u200b\u5982\u679c\u200b\u4e0d\u200b\u63d0\u4f9b\u200b <code>time</code>\uff0c\u200b\u5219\u200b\u8868\u793a\u200b\u67e5\u8be2\u200b\u5f53\u524d\u200b\u65f6\u95f4\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1a</p> <pre><code>result = instant_query(promql, None, timeout)\npprint(result)\n</code></pre> <p></p>"},{"location":"blog/prometheus/#262-\u8303\u56f4\u67e5\u8be2","title":"2.6.2 \u200b\u8303\u56f4\u200b\u67e5\u8be2","text":"<p>\u200b\u8303\u56f4\u200b\u67e5\u8be2\u200b\u83b7\u53d6\u200b Query \u200b\u5728\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u3001\u200b\u7ed9\u5b9a\u200b\u9891\u7387\u200b\u4e0b\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1b\u200b\u63a5\u53e3\u200b\u4e3a\u200b <code>/query_range</code>\uff0c\u200b\u53c2\u6570\u200b\u5305\u62ec\u200b <code>query</code>, <code>start</code>, <code>end</code>, <code>step</code> \u200b\u548c\u200b <code>timeout</code>\u3002\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>RANGE_QUERY = \"query_range/\"\n\ndef range_query(promql: str, start: str, end: str, step: str, timeout: Optional[str] = None):\n    url = f\"{API}{RANGE_QUERY}\"\n    data = {\n        \"query\": promql,\n        \"start\": start,\n        \"end\": end,\n        \"step\": step,\n        \"timeout\": timeout\n    }\n    response = requests.post(url, data=data)\n    if not response.ok:\n        raise requests.HTTPError(f\"Failed to query {url}: {response.text}\")\n    return response.json()\n\npromql = '''sum(fastapi_requests_total{path=~\"/v1/[^/]*/\"}) by (path)'''\nstart = \"2024-07-01T20:00:00.000Z\"\nend = \"2024-07-01T20:10:00.000Z\"\nstep = \"5m\"\n\nresult = range_query(promql, start, end, step, timeout)\npprint(result)\n</code></pre> <p></p> <p>\u200b\u4f46\u662f\u200b\uff0crange query \u200b\u4e0d\u200b\u652f\u6301\u200b\u67e5\u8be2\u200b Range Vector\uff0c\u200b\u53ea\u80fd\u200b\u67e5\u8be2\u200b Instant Vector, Scalar \u200b\u6216\u200b String\u3002\u200b\u56e0\u4e3a\u200b Range Vector \u200b\u672c\u8eab\u200b\u5c31\u662f\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u7684\u200b Instant Vector\uff0c\u200b\u6240\u4ee5\u200b\u8303\u56f4\u200b\u67e5\u8be2\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u4e00\u4e2a\u200b <code>matrix</code>\uff1a</p> <pre><code>promql = '''sum(fastapi_requests_total) by (path) [10m:2m]'''\n\ntry:\n    range_query(promql, start, end, step, timeout)\nexcept requests.HTTPError as e:\n    print(e)\n</code></pre> <p>\u200b\u7ed3\u679c\u200b\u662f\u200b <code>Failed to query &lt;API&gt;: {\"status\":\"error\",\"errorType\":\"bad_data\",\"error\":\"invalid expression type \\\"range vector\\\" for range query, must be Scalar or instant Vector\"}</code>\u3002</p> <p>\u200b\u5373\u4f7f\u200b\u67e5\u8be2\u200b\u7ed3\u679c\u200b\u662f\u200b\u4e00\u4e2a\u200b Scalar\uff0c\u200b\u8fd4\u56de\u200b\u7c7b\u578b\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b <code>matrix</code>\uff1a</p> <pre><code>promql = '''pi()'''\n\nresult = range_query(promql, start, end, step, timeout)\npprint(result)\n</code></pre> <p></p>"},{"location":"blog/prometheus/#\u5176\u4ed6\u63a5\u53e3","title":"\u5176\u4ed6\u200b\u63a5\u53e3","text":"<p>\u200b\u8fd8\u6709\u200b\u66f4\u200b\u591a\u200b\u63a5\u53e3\u200b\u53ef\u4ee5\u200b\u73a9\u200b\uff01\u200b\u8be6\u89c1\u200b HTTP API | Prometheus</p>"},{"location":"blog/prometheus/#3-examples","title":"3 Examples","text":"<p>Note</p> <p>\u200b\u8fd9\u200b\u4e00\u8282\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u4e00\u4e9b\u200b\u6211\u200b\u7528\u5230\u200b / \u200b\u89c1\u5230\u200b\u7684\u200b\u67e5\u8be2\u200b\u6837\u4f8b\u200b\u3002</p>"},{"location":"blog/daily-git/","title":"Daily Git","text":"<p>\u200b\u5927\u591a\u6570\u200b\u5f00\u53d1\u8005\u200b\u4f1a\u200b\u9891\u7e41\u200b\u7528\u5230\u200b Git\u3002\u200b\u4f46\u200b\u4e00\u4e9b\u200b\u540c\u5fd7\u200b\u6ca1\u6709\u200b\u7cfb\u7edf\u200b\u5b66\u4e60\u200b\u8fc7\u200b Git\uff0c\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u540c\u5fd7\u200b\u5b66\u4e60\u200b Git \u200b\u7684\u200b\u65f6\u95f4\u200b\u53ef\u80fd\u200b\u6bd4\u8f83\u200b\u53e4\u65e9\u200b\uff0c\u200b\u53c2\u8003\u200b\u7684\u200b\u8d44\u6599\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u6bd4\u8f83\u200b\u7ecf\u5178\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u672c\u6587\u200b\u5c1d\u8bd5\u200b\u4e3a\u200b\u719f\u6089\u200b Git \u200b\u5de5\u4f5c\u200b\u6d41\u200b\u7684\u200b\u670b\u53cb\u200b\u63d0\u4f9b\u200b\u4e00\u4e9b\u200b\u6211\u200b\u6700\u8fd1\u200b\u5b66\u5230\u200b\u7684\u200b Git \u200b\u7684\u200b\u57fa\u7840\u77e5\u8bc6\u200b\u4ee5\u53ca\u200b\u4e00\u4e9b\u200b\u6211\u200b\u89c9\u5f97\u200b\u6709\u7528\u200b\u7684\u200b\u6280\u5de7\u200b\u3002</p> <p>Warning</p> <p>\u200b\u672c\u6587\u200b\u5c1a\u672a\u200b\u5b8c\u5584\u200b</p> <p>\u200b\u4ece\u200b <code>.git</code> \u200b\u76ee\u5f55\u200b\u8bf4\u8d77\u200b\u3002</p> <p><code>branches</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b deprecated \u200b\u7684\u200b\u76ee\u5f55\u200b\uff0c\u200b\u65b0\u200b\u7684\u200b git \u200b\u7248\u672c\u200b\u5df2\u7ecf\u200b\u4e0d\u7528\u200b\u4e86\u200b\u3002</p> <p><code>objects</code> \u200b\u76ee\u5f55\u200b\u5b58\u50a8\u200b\u6240\u6709\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u5185\u5bb9\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u538b\u7f29\u200b\uff0c\u200b\u7136\u540e\u200b\u4ee5\u200b\u54c8\u5e0c\u200b\u503c\u200b\u547d\u540d\u200b\uff0c\u200b\u653e\u5728\u200b\u8fd9\u4e2a\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u3002</p> <p>\u200b\u793a\u4f8b\u200b\uff1a<code>echo \"Hello, World\\!\" &gt; init.txt</code> <code>git add init.txt</code> \u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b <code>objects</code> \u200b\u76ee\u5f55\u200b\u4e0b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b</p> <p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>zlib-flate -uncompress &lt; .git/objects/xx/xxxx</code> \u200b\u770b\u5230\u200b\u5176\u4e2d\u200b\u7684\u200b\u5185\u5bb9\u200b</p> <p>\u200b\u518d\u200b\u5c1d\u8bd5\u200b <code>zlib-flate -uncompress &lt; .git/objects/xx/xxxx | sha1sum</code> \u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b SHA \u200b\u4e00\u81f4\u200b</p> <p>\u200b\u7531\u4e8e\u200b SHA1 \u200b\u5df2\u7ecf\u200b\u88ab\u200b\u8bc1\u660e\u200b\u4e0d\u200b\u5b89\u5168\u200b\uff0c\u200b\u56e0\u6b64\u200b Git \u200b\u5728\u200b 2.13 \u200b\u4e2d\u200b\u505a\u200b\u4e86\u200b\u8865\u4e01\u200b\uff1b\u200b\u5728\u200b 2.29 \u200b\u4e2d\u200b\u5b9e\u9a8c\u6027\u200b\u652f\u6301\u200b SHA-256\uff1b\u200b\u5728\u200b 2.42 \u200b\u4e2d\u200b\u6b63\u5f0f\u200b\u652f\u6301\u200b SHA-256\uff1b\u200b\u5728\u200b 2.45 \u200b\u4e2d\u200b\u5b9e\u9a8c\u6027\u200b\u652f\u6301\u200b\u4e24\u79cd\u200b SHA \u200b\u7684\u200b\u4e92\u64cd\u4f5c\u200b</p> <p><code>git commit -m \"init\"</code> \u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b <code>refs</code> \u200b\u76ee\u5f55\u200b\u4e0b\u591a\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u6587\u4ef6\u200b\uff0c\u200b\u5206\u522b\u200b\u4f7f\u7528\u200b <code>git cat-file -p</code> \u200b\u67e5\u770b\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4e00\u4e2a\u200b tree \u200b\u548c\u200b\u4e00\u4e2a\u200b commit\uff1b\u200b\u6211\u4eec\u200b\u7a0d\u540e\u200b\u8ba8\u8bba\u200b\u8fd9\u4e2a\u200b tree \u200b\u662f\u200b\u600e\u4e48\u200b\u6765\u200b\u7684\u200b</p> <p><code>hooks</code> \u200b\u76ee\u5f55\u200b\u5b58\u50a8\u200b\u4e00\u4e9b\u200b\u94a9\u5b50\u200b\u811a\u672c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7279\u5b9a\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u53d1\u751f\u200b\u65f6\u200b\u6267\u884c\u200b\uff1b\u200b\u8fd9\u4e2a\u200b\u76ee\u5f55\u200b\u4e0b\u200b\u9ed8\u8ba4\u200b\u4f1a\u653e\u200b\u4e00\u4e9b\u200b\u793a\u4f8b\u200b\u811a\u672c\u200b</p> <p>\u200b\u770b\u200b\u4e00\u4e0b\u200b <code>pre-commit.sample</code>\uff1b\u200b\u8fd9\u91cc\u200b\u6211\u4eec\u200b\u770b\u5230\u200b\u4e86\u200b <code>git config</code> \u200b\u7684\u200b\u7528\u6cd5\u200b\uff1b\u200b\u4e8b\u5b9e\u4e0a\u200b <code>git config</code> \u200b\u662f\u200b\u53ef\u4ee5\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\uff0c\u200b\u81ea\u5b9a\u4e49\u200b\u914d\u7f6e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b hook \u200b\u4e4b\u7c7b\u200b\u7684\u200b\u5730\u65b9\u200b\u7528\u5230\u200b</p> <p><code>git config</code> \u200b\u63a7\u5236\u200b git \u200b\u7684\u200b\u884c\u4e3a\u200b\uff1b\u200b\u4e3b\u8981\u200b\u53ef\u4ee5\u200b\u5728\u200b 4 \u200b\u4e2a\u200b\u5730\u65b9\u200b\u8bbe\u7f6e\u200b\u914d\u7f6e\u200b\uff1a<code>/etc/gitconfig</code>\u3001<code>~/.gitconfig</code>\u3001<code>.git/config</code>, <code>.git/config.worktree</code>\uff0c\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b <code>--system</code>\u3001<code>--global</code>\u3001<code>--local</code>\u3001<code>--worktree</code>\uff0c\u200b\u4f18\u5148\u7ea7\u200b\u4ece\u200b\u4f4e\u200b\u5230\u200b\u9ad8\u200b</p> <p><code>git worktree</code> \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u65b0\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b\u5927\u5bb6\u200b WIP \u200b\u4f46\u662f\u200b\u8981\u200b\u8f6c\u800c\u200b\u5f00\u53d1\u200b\u4e2a\u522b\u200b\u7684\u200b\u4e1c\u897f\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u4e0d\u60f3\u200b <code>git stash</code> \u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u4f46\u662f\u200b\u5b83\u200b\u548c\u200b\u6211\u4eec\u200b\u7684\u200b monorepo + bazel \u200b\u7684\u200b\u73a9\u6cd5\u200b\u76f8\u6027\u200b\u4e0d\u662f\u200b\u5f88\u200b\u597d\u200b\uff0c\u200b\u800c\u4e14\u200b\u6211\u200b\u4e5f\u200b\u4e0d\u200b\u89c9\u5f97\u200b <code>git stash</code> \u200b\u4e0d\u597d\u200b\u7528\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u5b66\u8fc7\u200b</p> <p><code>git stash</code> \u200b\u5c31\u200b\u4e0d\u804a\u200b\u4e86\u200b\uff0c\u200b\u5927\u5bb6\u200b\u90fd\u200b\u77e5\u9053\u200b</p> <p>\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>git config --list --show-origin</code> \u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u914d\u7f6e\u200b\u3002\u200b\u4f8b\u5982\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6211\u200b\u6709\u200b <code>push.autosetupremote=true</code>\uff0c\u200b\u8fd9\u4e2a\u200b\u8868\u793a\u200b <code>git push</code> \u200b\u65f6\u200b\u5982\u679c\u200b remote \u200b\u4e0a\u200b\u6ca1\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u4f1a\u200b\u81ea\u52a8\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u62a5\u9519\u200b\u3002(\u200b\u5982\u679c\u200b\u4f60\u200b\u53d1\u73b0\u200b\u4f60\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u9009\u9879\u200b\u6ca1\u200b\u751f\u6548\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5347\u7ea7\u200b\u4e00\u4e0b\u200b git\uff1b\u200b\u73b0\u5728\u200b\u5f00\u53d1\u200b\u673a\u200b\u9884\u88c5\u200b\u7684\u200b\u7248\u672c\u200b\u662f\u200b\u4e0d\u591f\u200b\u9ad8\u200b\u7684\u200b)</p> <p>\u200b\u6211\u200b\u8fd8\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u4e00\u5806\u200b alias\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b \u200b\u8fd9\u4e9b\u200b \u200b\u4f8b\u5b50\u200b \u200b\u4e2d\u200b \u200b\u627e\u5230\u200b\u4e00\u4e9b\u200b\u6709\u7528\u200b\u7684\u200b\u914d\u7f6e\u200b\uff1b\u200b\u4e09\u4e2a\u200b\u7684\u200b\u98ce\u683c\u200b\u5404\u6709\u4e0d\u540c\u200b\uff0c\u200b\u5927\u5bb6\u200b\u6709\u200b\u5174\u8da3\u200b\u53ef\u4ee5\u200b\u81ea\u5df1\u200b\u63a2\u7d22\u200b\u4e00\u4e0b\u200b</p> <p><code>refs</code> \u200b\u5b58\u653e\u200b\u672c\u5730\u200b\u5206\u652f\u200b\u3001\u200b\u8fdc\u7a0b\u200b\u5206\u652f\u200b\u548c\u200b tags \u200b\u7684\u200b\u5f15\u7528\u200b\uff1b\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u5b58\u653e\u200b\u7684\u200b\u5176\u5b9e\u200b\u662f\u200b\u4e00\u4e2a\u200b commit \u200b\u7684\u200b\u54c8\u5e0c\u200b\u503c\u200b</p> <p><code>git for-each-ref</code> \u200b\u53ef\u4ee5\u200b\u67e5\u770b\u200b\u548c\u200b\u7b5b\u9009\u200b tags or branches\uff1b\u200b\u4f8b\u5982\u200b <code>git for-each-ref --sort=-creatordate --format=\"%(refname:short)\" refs/tags/</code> \u200b\u56e0\u6b64\u200b\u5982\u679c\u200b <code>.. | grep \"prod-release\" | head -n 1</code> \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7b5b\u9009\u200b\u51fa\u200b\u6700\u65b0\u200b\u7684\u200b\u542b\u200b <code>prod-release</code> \u200b\u7684\u200b tag \u200b\u4e86\u200b</p> <p>\u200b\u4ec0\u4e48\u200b\u662f\u200b\u8fdc\u7a0b\u200b\uff1f\u200b\u5176\u5b9e\u200b\u8fdc\u7a0b\u200b\u975e\u5e38\u7b80\u5355\u200b\uff0c\u200b\u751a\u81f3\u200b\u53ef\u4ee5\u200b\u5728\u200b\u672c\u5730\u200b\u3002\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b <code>git init --bare .</code> \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b bare repo\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u76ee\u5f55\u200b\u5c06\u200b\u8fd9\u4e2a\u200b\u8def\u5f84\u200b <code>git remote add origin /path/to/repo</code>\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u672c\u5730\u200b\u64cd\u4f5c\u200b\u8fdc\u7a0b\u200b\u4ed3\u5e93\u200b\u4e86\u200b\u3002 bare repo \u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u6ca1\u6709\u200b working directory \u200b\u7684\u200b repo\uff0c\u200b\u53ea\u6709\u200b\u5c55\u5f00\u200b\u7684\u200b <code>.git</code> \u200b\u76ee\u5f55\u200b\uff1b\u200b\u8fd9\u662f\u200b\u4f5c\u4e3a\u200b remote \u200b\u7684\u200b best practice\uff0c\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b repo \u200b\u53ea\u662f\u200b\u7528\u6765\u200b\u5171\u4eab\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4e0d\u662f\u200b\u7528\u6765\u200b\u5f00\u53d1\u200b\u7684\u200b\u3002</p> <pre><code>mkcd ~/git/remote\ngit init . --bare\ntree -a ~/git/remote\n\nmkcd ~/git/repo\ngit init .\ngit remote add origin ~/git/remote\n\necho \"Hello, World\\!\" &gt; init.txt\ngit add .\ngit commit -m \"init\"\ngit push\ntree -a ~/git/remote\n\nmkcd ~/git/another_local\ngit clone ~/git/remote .\ntree . -a\n</code></pre> <p>\u200b\u5c55\u793a\u200b\u4e00\u4e0b\u200b <code>git push</code> \u200b\u7684\u200b\u6548\u679c\u200b\uff0c\u200b\u5c55\u793a\u200b\u4e00\u4e0b\u200b <code>git fetch</code>\uff1b\u200b\u6240\u4ee5\u200b\u5176\u5b9e\u200b remote \u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u51e0\u4e2a\u200b repo \u200b\u4e4b\u95f4\u200b\u4ea4\u6362\u200b objects \u200b\u548c\u200b refs\u3002</p> <p><code>packed_refs</code> \u200b\u5b58\u50a8\u200b\u4e00\u4e9b\u200b packed refs\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u79cd\u200b\u4f18\u5316\u200b\uff0c\u200b\u5c06\u200b\u4e00\u4e9b\u200b refs \u200b\u6253\u5305\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u51cf\u5c11\u200b\u6587\u4ef6\u200b\u6570\u91cf\u200b\uff0c\u200b\u4ee5\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\u3002Git 2.45 \u200b\u5f15\u5165\u200b\u4e86\u200b \u200b\u65b0\u200b\u7684\u200b\u60f3\u6cd5\u200b</p> <p><code>logs</code> \u200b\u76ee\u5f55\u200b\u5b58\u50a8\u200b\u4e00\u4e9b\u200b\u65e5\u5fd7\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5305\u62ec\u200b reflog\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u6062\u590d\u200b\u4e00\u4e9b\u200b\u8bef\u64cd\u4f5c\u200b</p> <p>\u200b\u4f8b\u5982\u200b\u5f53\u200b\u6211\u4eec\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u6539\u5199\u200b\u5386\u53f2\u200b\u7684\u200b\u64cd\u4f5c\u200b\u4e4b\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>git reflog</code> \u200b\u67e5\u770b\u200b\u5386\u53f2\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u7136\u540e\u200b <code>git reset</code> \u200b\u6062\u590d\u200b\u4e4b\u524d\u200b\u7684\u200b\u72b6\u6001\u200b</p> <p>\u200b\u4f46\u662f\u200b\u8981\u200b\u6ce8\u610f\u200b\uff0c<code>git reflog</code> \u200b\u53ea\u4f1a\u200b\u8bb0\u5f55\u200b\u672c\u5730\u200b\u53d1\u751f\u200b\u8fc7\u200b\u7684\u200b\u53d8\u66f4\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b\u5728\u200b remote \u200b\u4e0a\u200b\u53d1\u751f\u200b\u7684\u200b\u3001\u200b\u6ca1\u6709\u200b\u88ab\u200b fetch \u200b\u4e0b\u6765\u200b\u7684\u200b\u53d8\u66f4\u200b\uff0c\u200b\u672c\u5730\u200b\u81ea\u7136\u200b\u662f\u200b\u6ca1\u6709\u200b\u7684\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b <code>git push -f</code> \u200b\u8986\u76d6\u200b\u4e86\u200b\u522b\u4eba\u200b\u7684\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u9664\u975e\u200b\u53bb\u200b remote \u200b\u670d\u52a1\u5668\u200b\u4e0a\u200b\u67e5\u770b\u200b\uff0c\u200b\u6216\u8005\u200b\u53bb\u6c42\u200b\u540c\u4e8b\u200b\u91cd\u65b0\u200b push \u200b\u4e00\u904d\u200b\uff0c\u200b\u5426\u5219\u200b\u662f\u200b\u6ca1\u6cd5\u200b\u6062\u590d\u200b\u7684\u200b\uff08\u200b\u66f4\u574f\u200b\u7684\u200b\u60c5\u51b5\u200b\u662f\u200b\u6839\u672c\u200b\u6ca1\u200b\u53d1\u73b0\u200b\uff09</p> <p>\u200b\u56e0\u6b64\u200b\u6211\u4eec\u200b\u5411\u200b\u5927\u5bb6\u200b\u9686\u91cd\u200b\u4ecb\u7ecd\u200b <code>git push --force-with-lease</code>\uff0c\u200b\u8fd9\u4e2a\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u68c0\u67e5\u200b remote \u200b\u4e0a\u200b\u7684\u200b ref \u200b\u662f\u5426\u200b\u548c\u200b\u672c\u5730\u200b\u5df2\u77e5\u200b\u7684\u200b remote ref \u200b\u4e00\u81f4\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u5c31\u200b\u4e0d\u4f1a\u200b push\uff0c\u200b\u4ee5\u200b\u907f\u514d\u200b\u8986\u76d6\u200b\u672a\u200b\u88ab\u200b pull \u200b\u7684\u200b\u63d0\u4ea4\u200b\u3002</p> <p>\u200b\u8bf7\u200b\u6ce8\u610f\u200b\uff1a\u200b\u8fd9\u4e2a\u200b\u6307\u4ee4\u200b\u7684\u200b\u8bed\u4e49\u200b\uff08\u200b\u5177\u4f53\u200b\u505a\u200b\u4ec0\u4e48\u200b\u5224\u65ad\u200b\uff09\u200b\u53ef\u80fd\u200b\u8fd8\u4f1a\u200b\u53d8\u5316\u200b\uff0c\u200b\u5b83\u200b\u300c\u200b\u53ef\u80fd\u200b\u968f\u200b git \u200b\u56e2\u961f\u200b\u7684\u200b\u7ecf\u9a8c\u200b\u800c\u200b\u6539\u53d8\u200b\u300d\uff1b\u200b\u4f46\u200b\u5176\u200b\u89e3\u51b3\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\u786e\u5b9a\u200b\u7684\u200b\u3002</p> <p><code>info</code> \u200b\u76ee\u5f55\u200b\u5b58\u50a8\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>info/exclude</code> \u200b\u7528\u6765\u200b\u5b58\u50a8\u200b <code>.gitignore</code> \u200b\u4e4b\u5916\u200b\u7684\u200b ignore \u200b\u89c4\u5219\u200b\uff1b\u200b\u8fd9\u200b\u8868\u793a\u200b\u6211\u200b\u5e0c\u671b\u200b\u5728\u200b\u8fd9\u4e2a\u200b repo \u200b\u4e2d\u200b\u5ffd\u7565\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u5e0c\u671b\u200b\u63d0\u4ea4\u200b\u5230\u200b <code>.gitignore</code> \u200b\u4e2d\u200b</p> <p>\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c<code>exclude</code> \u200b\u548c\u200b <code>.gitignore</code> \u200b\u90fd\u200b\u662f\u200b\u9488\u5bf9\u200b untracked \u200b\u6587\u4ef6\u200b\u7684\u200b\uff1b\u200b\u5982\u679c\u200b\u6587\u4ef6\u200b\u5df2\u7ecf\u200b\u88ab\u200b track \u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5373\u4f7f\u200b\u5728\u200b\u5176\u4e2d\u200b\u65b0\u589e\u200b\u4e86\u200b\uff0c\u200b\u672a\u6765\u200b\u7684\u200b\u66f4\u65b0\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5ffd\u7565\u200b</p> <p>\u200b\u90a3\u200b\u5982\u679c\u200b\u6211\u200b\u786e\u5b9e\u200b\u60f3\u8981\u200b\u5ffd\u7565\u200b\u4e00\u4e2a\u200b\u5df2\u7ecf\u200b\u88ab\u200b track \u200b\u7684\u200b\u6587\u4ef6\u200b\u5462\u200b\uff1f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git update-index --skip-worktree</code>\uff0c\u200b\u8fd9\u4e2a\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u5c06\u200b\u6587\u4ef6\u200b\u6807\u8bb0\u200b\u4e3a\u200b skip worktree\uff0c\u200b\u8fd9\u6837\u200b\u5373\u4f7f\u200b\u6587\u4ef6\u200b\u88ab\u200b\u4fee\u6539\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u63d0\u4ea4\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u72b6\u6001\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u63d0\u4ea4\u200b\u5230\u200b remote \u200b\u8fd9\u200b\u5bf9\u4e8e\u200b\u300c\u200b\u6211\u200b\u60f3\u200b\u5728\u200b\u672c\u5730\u200b\u6539\u4e9b\u200b\u914d\u7f6e\u200b\u300d\u200b\u7684\u200b\u60c5\u51b5\u200b\u975e\u5e38\u200b\u6709\u7528\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6211\u200b\u5728\u200b\u672c\u5730\u200b clone \u200b\u4e86\u200b\u4e24\u4e2a\u200b\u4ed3\u5e93\u200b\u6765\u200b\u5206\u522b\u200b\u542f\u52a8\u200b\u4e24\u5957\u200b\u670d\u52a1\u200b\uff0c\u200b\u6211\u4f1a\u200b\u4fee\u6539\u200b\u542f\u52a8\u200b\u670d\u52a1\u200b\u7684\u200b\u811a\u672c\u200b\u4e2d\u200b\u7684\u200b\u7aef\u53e3\u53f7\u200b\uff0c\u200b\u4f46\u662f\u200b\u901a\u8fc7\u200b\u8fd9\u4e2a\u200b\u65b9\u5f0f\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u4e0d\u8981\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6211\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u4e0d\u200b\u5c0f\u5fc3\u200b\u63d0\u4ea4\u200b\u5230\u200b remote \u200b\u4e86\u200b</p> <p>\u200b\u4e0d\u8fc7\u200b\u5f88\u200b\u9057\u61be\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u76ee\u524d\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u4e00\u4e2a\u200b\u65b9\u5f0f\u200b\u80fd\u200b\u8ba9\u200b\u6240\u6709\u200b\u5f00\u53d1\u8005\u200b\u90fd\u200b\u4e0d\u200b\u63d0\u4ea4\u200b\u8fd9\u4e2a\u200b\u6587\u4ef6\u200b\uff1b\u200b\u6240\u4ee5\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u53ea\u80fd\u200b\u7528\u200b\u5728\u200b\u4e2a\u4eba\u200b\u5f00\u53d1\u200b\u7684\u200b\u573a\u666f\u200b\u4e2d\u200b</p> <p><code>config</code> \u200b\u6587\u4ef6\u200b\u7684\u200b\u7528\u9014\u200b\uff0c\u200b\u521a\u624d\u200b\u5df2\u7ecf\u200b\u804a\u8fc7\u200b\u4e86\u200b</p> <p><code>HEAD</code> \u200b\u6587\u4ef6\u200b\u5b58\u50a8\u200b\u5f53\u524d\u200b\u6240\u5728\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u6216\u8005\u200b\u5f53\u524d\u200b\u6240\u5728\u200b\u7684\u200b commit</p> <p><code>index</code> \u200b\u662f\u200b git \u200b\u4e2d\u200b\u7279\u522b\u200b\u91cd\u8981\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b working directory \u200b\u548c\u200b repo \u200b\u4e4b\u95f4\u200b\u7684\u200b\u6865\u6881\u200b</p> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b \u200b\u8fd9\u91cc\u200b \u200b\u770b\u5230\u200b\u4e00\u4e2a\u200b\u5f88\u200b\u597d\u200b\u7684\u200b interactive cheetsheet</p> <p>\u200b\u5176\u4e2d\u200b <code>git restore</code> \u200b\u548c\u200b <code>git switch</code> \u200b\u4e0d\u662f\u200b\u5f88\u200b\u5168\u9762\u200b</p> <p>\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6307\u4ee4\u200b\u7528\u6765\u200b\u89e3\u51b3\u200b\u300c\u200b\u6240\u6709\u200b\u4e8b\u60c5\u200b\u90fd\u200b\u662f\u200b <code>git checkout</code> \u200b\u505a\u200b\u7684\u200b\u300d\u200b\u7684\u200b\u95ee\u9898\u200b</p> <p><code>git add -i</code> \u200b\u53ef\u4ee5\u200b\u4ea4\u4e92\u5f0f\u200b\u5730\u200b\u5b8c\u6210\u200b <code>git add</code>\uff0c\u200b\u5305\u62ec\u200b\u53ea\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\uff1b\u200b\u800c\u200b <code>git add -p</code> \u200b\u5219\u200b\u76f4\u63a5\u200b\u8fdb\u5165\u200b patch \u200b\u6a21\u5f0f\u200b \u200b\u503c\u5f97\u4e00\u63d0\u7684\u662f\u200b <code>git stash</code> \u200b\u4e5f\u200b\u6709\u200b <code>-p</code>\u3002</p> <p>\u200b\u5982\u679c\u200b\u5728\u200b\u67d0\u4e2a\u200b\u5b50\u76ee\u5f55\u200b\uff0c\u200b\u60f3\u8981\u200b <code>git add</code> \u200b\u4ed3\u5e93\u200b\u4e2d\u200b\u7684\u200b\u6240\u6709\u200b\u6587\u4ef6\u200b\u800c\u200b\u4e0d\u200b\u53ea\u662f\u200b\u5f53\u524d\u76ee\u5f55\u200b\u4e0b\u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git add :/</code> \u200b\u6216\u8005\u200b <code>git add -A</code>\u3002</p> <p><code>:/</code> \u200b\u662f\u200b pathspec \u200b\u7684\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u8868\u793a\u200b repo root\uff1b\u200b\u4f8b\u5982\u200b <code>:/app</code> \u200b\u8868\u793a\u200b repo root \u200b\u4e0b\u200b\u7684\u200b app \u200b\u76ee\u5f55\u200b\u3002</p> <p>\u200b\u53e6\u5916\u200b <code>git add -u</code> \u200b\u53ea\u4f1a\u200b add \u200b\u5df2\u7ecf\u200b\u88ab\u200b track \u200b\u7684\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e0d\u4f1a\u200b add \u200b\u65b0\u200b\u6587\u4ef6\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>git add -u :/</code>\u3002</p> <p>pathspec \u200b\u7684\u200b\u53e6\u200b\u4e00\u79cd\u200b\u6709\u7528\u200b\u5f62\u5f0f\u200b\u662f\u200b <code>:!</code>\uff0c\u200b\u8868\u793a\u200b exclude\uff1b\u200b\u4f8b\u5982\u200b <code>git add . \":!app\"</code> \u200b\u8868\u793a\u200b add repo root \u200b\u4e0b\u200b\u7684\u200b\u6240\u6709\u200b\u6587\u4ef6\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b add app \u200b\u76ee\u5f55\u200b\u3002 - \u200b\u5728\u200b zsh \u200b\u4e2d\u200b\uff0c<code>!</code> \u200b\u9700\u8981\u200b\u8f6c\u4e49\u200b\u5199\u4e3a\u200b <code>\\!</code> - \u200b\u5f53\u7136\u200b\u8fd9\u79cd\u200b case \u200b\u6211\u200b\u4e00\u822c\u200b\u4f1a\u200b\u9009\u62e9\u200b <code>git add .</code> \u200b\u7136\u540e\u200b <code>git restore --staged app</code></p> <p>\u200b\u5173\u4e8e\u200b\u51e0\u79cd\u200b <code>git add</code> \u200b\u7684\u200b\u533a\u522b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b \u200b\u8fd9\u91cc\u200b\u3002</p> <p>TODO</p> <ul> <li>https://github.com/tj/git-extras/blob/master/Commands.md</li> <li>https://github.com/git-tips/tips</li> </ul> <p>\u200b\u4f7f\u7528\u200b <code>git commit --fixup</code> \u200b\u548c\u200b <code>git rebase --autosquash</code> \u200b\u6765\u200b fixup \u200b\u4e00\u4e2a\u200b\u9065\u8fdc\u200b\u7684\u200b commit\uff1ahttps://andrewlock.net/smoother-rebases-with-auto-squashing-git-commits/ \u200b\u81ea\u200b 2.44 \u200b\u8d77\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b <code>-i</code> \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b <code>--autosquash</code> \u200b\u4e86\u200b\uff01</p>"},{"location":"blog/git-remote/","title":"Git Remote","text":""},{"location":"blog/common-python-code/","title":"\u5e38\u7528\u200b Python \u200b\u4ee3\u7801\u200b\u5907\u5fd8","text":""},{"location":"blog/common-python-code/#loguru-logger---stderr","title":"<code>loguru logger -&gt; stderr</code>","text":"<pre><code>import sys\nfrom loguru import logger\nlogger.remove()\nlogger.add(sys.stderr)\n</code></pre>"},{"location":"blog/archive/2024/","title":"2024-09","text":""},{"location":"blog/category/rainbowtopics/","title":"Topics","text":""},{"location":"blog/category/writing_hand_tone1git/","title":"Git","text":""},{"location":"blog/category/rainbowdaily/","title":"Daily","text":""},{"location":"blog/category/writing_hand_tone1python/","title":"Python","text":""},{"location":"blog/category/newspaperobservability/","title":"Observability","text":""},{"location":"blog/category/newspaperprometheus/","title":"Prometheus","text":""},{"location":"blog/category/booksgit/","title":"Git","text":""},{"location":"blog/category/sparkleszsh/","title":"ZSH","text":""},{"location":"blog/category/booksmkdocs/","title":"MkDocs","text":""}]}